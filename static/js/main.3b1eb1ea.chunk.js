(this["webpackJsonppan-vision-viewer"]=this["webpackJsonppan-vision-viewer"]||[]).push([[0],{113:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return u}));var i=n(17),r=n.n(i),a=n(24),o=n(2),s=n(3),l=n(146),c=n(47),u=function(){function t(){Object(o.a)(this,t),this.buffer=null,this.pixels=new Uint8Array,this.width=0,this.height=0,this.depth=0,this.bits=0}return Object(s.a)(t,[{key:"open",value:function(){var e=Object(a.a)(r.a.mark((function e(t){var n,i,a,o,s;return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e,n){var i=new FileReader;i.readAsArrayBuffer(t),i.onload=function(t){e(t.target.result)},i.onerror=function(e){n(i.error)},i.onabort=function(e){n("FileReader was aborted!")}}));case 2:if(n=e.sent,i=l.decode(n),0!==Object.keys(i[0]).length){e.next=6;break}throw new Error("Could not decode TIFF file!");case 6:if(c=i[0],1===(a={t256:c.t256,t257:c.t257,t258:c.t258,t277:c.t277}).t277[0]){e.next=9;break}throw new Error("Only grayscale images are supported.");case 9:if(8===a.t258[0]){e.next=11;break}throw new Error("Only images with bit depth 8 are supported.");case 11:o=0;case 12:if(!(o<i.length)){e.next=19;break}if(r=i[o],s={t256:r.t256,t257:r.t257,t258:r.t258,t277:r.t277},JSON.stringify(a)===JSON.stringify(s)){e.next=16;break}throw new Error("Slice "+o+" has incorrect dimensions or pixel depth.");case 16:++o,e.next=12;break;case 19:this.buffer=n,this.width=a.t256[0],this.height=a.t257[0],this.depth=i.length,this.bits=a.t258[0];case 24:case"end":return e.stop()}var r,c}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"decode",value:function(){var t=Object(a.a)(r.a.mark((function t(n,i){var a,o;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=new Worker(e,{name:"tiff-worker",type:void 0}),o=c.b(a),t.next=4,o(this.buffer,c.a(n),c.a(i));case 4:this.pixels=t.sent,a.terminate();case 6:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()}]),t}()}).call(this,n(171))},116:function(e,t,n){},144:function(e,t,n){"use strict";(function(e){var i=n(17),r=n.n(i),a=n(24),o=n(2),s=n(3),l=n(15),c=n(4),u=n(5),d=n(0),h=n(154),m=n(155),p=n(47),f=n(113),v=n(1),b=function(t){Object(c.a)(i,t);var n=Object(u.a)(i);function i(e){var t;return Object(o.a)(this,i),(t=n.call(this,e)).state={tiffProtein:"",tiffSegmentation:"",voxelSize:"",proteinProgress:0,segmentationProgress:0,sdfProgress:0,proteinError:"",segmentationError:"",sdfError:"",step:"dialog",preImportError:""},t.handleImport=t.handleImport.bind(Object(l.a)(t)),t.handleClose=t.handleClose.bind(Object(l.a)(t)),t.onProteinProgress=t.onProteinProgress.bind(Object(l.a)(t)),t.onSegmentationProgress=t.onSegmentationProgress.bind(Object(l.a)(t)),t.onProteinError=t.onProteinError.bind(Object(l.a)(t)),t.onSegmentationError=t.onSegmentationError.bind(Object(l.a)(t)),t.onSdfProgress=t.onSdfProgress.bind(Object(l.a)(t)),t.onSdfError=t.onSdfError.bind(Object(l.a)(t)),t}return Object(s.a)(i,[{key:"onProteinProgress",value:function(e){this.setState({proteinProgress:e})}},{key:"onSegmentationProgress",value:function(e){this.setState({segmentationProgress:e})}},{key:"onProteinError",value:function(e){this.setState({proteinError:e})}},{key:"onSegmentationError",value:function(e){this.setState({segmentationError:e})}},{key:"onSdfProgress",value:function(e){this.setState({sdfProgress:e})}},{key:"onSdfError",value:function(e){this.setState({sdfError:e})}},{key:"handleImport",value:function(){var t=Object(a.a)(r.a.mark((function t(n,i,a){var o,s,l,c,u,d,h,m,v,b,g,j,x,y,S,w,O,k,C,P,D,z,V,T,M,I,F,E,U,N,L,R,A,B,H,_,G,q=this;return r.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=new f.a,s=new f.a,t.prev=2,t.next=5,o.open(n);case 5:return t.next=7,s.open(i);case 7:t.next=13;break;case 9:return t.prev=9,t.t0=t.catch(2),this.setState({preImportError:t.t0.message}),t.abrupt("return");case 13:if(o.width===s.width&&o.height===s.height&&o.depth===s.depth){t.next=16;break}return this.setState({preImportError:"Please make sure the protein and the segmentation data have the same dimensions."}),t.abrupt("return");case 16:return this.setState({step:"import",voxelSize:a,tiffProtein:o,tiffSegmentation:s,segmentationProgress:0,proteinProgress:0,sdfProgress:0,segmentationError:"",proteinError:"",sdfError:""}),t.next=19,o.decode(this.onProteinError,this.onProteinProgress);case 19:return t.next=21,s.decode(this.onSegmentationError,this.onSegmentationProgress);case 21:for(l=function(e,t){return Math.max(e,t)},c=s.pixels.reduce(l),u=[],d=[],h=new Array(c+1),m=function(t){var n=t,i=function(e){h[n]=100*e,q.onSdfProgress(h.reduce((function(e,t){return e+t}),0)/(c+1))};u.push(new Promise((function(t,r){var o=new Worker(e,{name:"sdf-worker",type:void 0});d.push(o),t(p.b(o)(s,a,n,p.a(i)))})))},v=0;v<c+1;++v)m(v);b=[],g=0;case 30:if(!(g<u.length)){t.next=39;break}return t.t1=b,t.next=34,u[g];case 34:t.t2=t.sent,t.t1.push.call(t.t1,t.t2);case 36:++g,t.next=30;break;case 39:for(j=0;j<d.length;++j)d[j].terminate();for(this.onSdfProgress(100),x=[],y=o.width,S=o.height,w=o.depth,O=new Uint8Array(2*y*S*w),k=0;k<y;++k)for(C=0;C<S;++C)for(P=0;P<w;++P)O[2*(P*y*S+C*y+k)]=o.pixels[P*y*S+C*y+k],O[2*(P*y*S+C*y+k)+1]=O[2*(P*y*S+C*y)+k];x.push(O);case 48:for(D=y,z=S,V=w,y=Math.ceil(y/2),S=Math.ceil(S/2),w=Math.ceil(w/2),T=x[x.length-1],M=new Uint8Array(2*y*S*w),I=0;I<D;++I)for(F=0;F<z;++F)for(E=0;E<V;++E)U=Math.floor(I/2),N=Math.floor(F/2),L=Math.floor(E/2),M[2*(L*y*S+N*y+U)]=Math.max(M[2*(L*y*S+N*y+U)],T[2*(E*D*z+F*D+I)]),M[2*(L*y*S+N*y+U)+1]=Math.min(M[2*(L*y*S+N*y+U)+1],T[2*(E*D*z+F*D+I)+1]);if(x.push(M),!(y<=1||S<=1||w<=1)){t.next=61;break}return t.abrupt("break",63);case 61:t.next=48;break;case 63:for(8,R=new Float32Array(Math.pow(2,8)),A=new Float32Array(Math.pow(2,8)),B=0;B<b[0].length;++B)R[b[0][B]]+=o.pixels[B],A[b[0][B]]+=1;for(H=0;H<R.length;++H)R[H]=R[H]/A[H];for(_=[],G=0;G<256;++G)_.push(G/10-5);this.setState({step:"dialog"}),this.props.onComplete(b,x,[o.width,o.height,o.depth],[parseFloat(a.x),parseFloat(a.y),parseFloat(a.z)],R,_);case 72:case"end":return t.stop()}}),t,this,[[2,9]])})));return function(e,n,i){return t.apply(this,arguments)}}()},{key:"handleClose",value:function(){this.props.onAbort()}},{key:"render",value:function(){return Object(v.jsxs)(v.Fragment,{children:[Object(v.jsx)(h.a,{show:"dialog"===this.state.step&&this.props.show,error:this.state.preImportError,onImport:this.handleImport,onClose:this.handleClose}),Object(v.jsx)(m.a,{show:"import"===this.state.step&&this.props.show,proteinProgress:this.state.proteinProgress,segmentationProgress:this.state.segmentationProgress,sdfProgress:this.state.sdfProgress,proteinError:this.state.proteinError,segmentationError:this.state.segmentationError,sdfError:this.state.sdfError})]})}}]),i}(d.Component);t.a=b}).call(this,n(166))},154:function(e,t,n){"use strict";var i=n(17),r=n.n(i),a=n(24),o=n(2),s=n(3),l=n(15),c=n(4),u=n(5),d=n(0),h=n(86),m=n(20),p=n(28),f=n(18),v=n(64),b=n(1),g=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e){var i;return Object(o.a)(this,n),(i=t.call(this,e)).handleChangeX=i.handleChangeX.bind(Object(l.a)(i)),i.handleChangeY=i.handleChangeY.bind(Object(l.a)(i)),i.handleChangeZ=i.handleChangeZ.bind(Object(l.a)(i)),i}return Object(s.a)(n,[{key:"handleChangeX",value:function(e){this.props.onChange({x:e.target.value,y:this.props.value.y,z:this.props.value.z})}},{key:"handleChangeY",value:function(e){this.props.onChange({x:this.props.value.x,y:e.target.value,z:this.props.value.z})}},{key:"handleChangeZ",value:function(e){this.props.onChange({x:this.props.value.x,y:this.props.value.y,z:e.target.value})}},{key:"render",value:function(){return Object(b.jsxs)(v.a,{className:"mb-3",children:[Object(b.jsx)(v.a.Text,{children:"Voxel Size"}),Object(b.jsx)(f.a.Control,{type:"number",placeholder:"x",value:this.props.value.x,onChange:this.handleChangeX}),Object(b.jsx)(f.a.Control,{type:"number",placeholder:"y",value:this.props.value.y,onChange:this.handleChangeY}),Object(b.jsx)(f.a.Control,{type:"number",placeholder:"z",value:this.props.value.z,onChange:this.handleChangeZ})]})}}]),n}(d.Component),j=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e){var i;return Object(o.a)(this,n),(i=t.call(this,e)).state={fileProtein:"",fileSegmentation:"",voxelSize:{x:"",y:"",z:""},working:!1},i.handleClickImport=i.handleClickImport.bind(Object(l.a)(i)),i.handleChangeFileProtein=i.handleChangeFileProtein.bind(Object(l.a)(i)),i.handleChangeFileSegmentation=i.handleChangeFileSegmentation.bind(Object(l.a)(i)),i.handleChangeVoxelSize=i.handleChangeVoxelSize.bind(Object(l.a)(i)),i.handleClose=i.handleClose.bind(Object(l.a)(i)),i}return Object(s.a)(n,[{key:"handleChangeFileProtein",value:function(e){this.setState({fileProtein:e.target.files[0]})}},{key:"handleChangeFileSegmentation",value:function(e){this.setState({fileSegmentation:e.target.files[0]})}},{key:"handleChangeVoxelSize",value:function(e){this.setState({voxelSize:e})}},{key:"handleClickImport",value:function(){var e=Object(a.a)(r.a.mark((function e(t){return r.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setState({working:!0}),this.props.onImport(this.state.fileProtein,this.state.fileSegmentation,this.state.voxelSize),this.setState({working:!1});case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleClose",value:function(e){this.props.onClose()}},{key:"render",value:function(){var e,t;return e=!(!(this.state.fileProtein&&this.state.fileSegmentation&&this.state.voxelSize.x&&this.state.voxelSize.y&&this.state.voxelSize.z)||this.state.working),this.props.error&&(t=Object(b.jsx)(h.a,{variant:"danger",children:this.props.error})),Object(b.jsxs)(p.a,{show:this.props.show,onHide:this.handleClose,children:[Object(b.jsx)(p.a.Header,{closeButton:!0,children:Object(b.jsx)(p.a.Title,{children:"Import Data"})}),Object(b.jsxs)(p.a.Body,{children:[Object(b.jsxs)(f.a,{children:[Object(b.jsxs)(f.a.Group,{className:"mb-3",children:[Object(b.jsx)(f.a.Label,{children:"Protein Data"}),Object(b.jsx)(f.a.Control,{type:"file",onChange:this.handleChangeFileProtein})]}),Object(b.jsxs)(f.a.Group,{className:"mb-3",children:[Object(b.jsx)(f.a.Label,{children:"Segmentation Data"}),Object(b.jsx)(f.a.Control,{type:"file",onChange:this.handleChangeFileSegmentation})]}),Object(b.jsx)(g,{value:this.state.voxelSize,onChange:this.handleChangeVoxelSize})]}),t]}),Object(b.jsx)(p.a.Footer,{children:Object(b.jsx)(m.a,{variant:"primary",disabled:!e,onClick:this.handleClickImport,children:"Import"})})]})}}]),n}(d.Component);t.a=j},155:function(e,t,n){"use strict";var i=n(2),r=n(3),a=n(4),o=n(5),s=n(0),l=n(28),c=(n(116),n(86)),u=n(115),d=n(1),h=function(e){Object(a.a)(n,e);var t=Object(o.a)(n);function n(){return Object(i.a)(this,n),t.apply(this,arguments)}return Object(r.a)(n,[{key:"render",value:function(){var e="";this.props.progress>=100&&(e="success"),this.props.error&&(e="danger");var t,n=this.props.progress<100&&!this.props.error;return this.props.error&&(t=Object(d.jsx)(c.a,{variant:"danger",children:this.props.error})),Object(d.jsxs)("div",{className:"labeled-progress-bar",children:[Object(d.jsxs)(u.a,{children:[Object(d.jsx)("div",{className:"label-front",style:{clipPath:"inset(0 ".concat(100-this.props.progress,"% 0 0)")},children:this.props.label}),Object(d.jsx)("div",{className:"label-back",children:this.props.label}),Object(d.jsx)(u.a,{striped:!0,variant:e,animated:n,now:this.props.progress})]}),t]})}}]),n}(s.Component),m=h,p=function(e){Object(a.a)(n,e);var t=Object(o.a)(n);function n(e){var r;return Object(i.a)(this,n),(r=t.call(this,e)).state={proteinProgress:0,segmentationProgress:0,sdfProgress:0,proteinError:"",segmentationError:"",sdfError:""},r}return Object(r.a)(n,[{key:"componentDidMount",value:function(){}},{key:"componentWillUnmount",value:function(){}},{key:"render",value:function(){return Object(d.jsxs)(l.a,{backdrop:"static",show:this.props.show,children:[Object(d.jsx)(l.a.Header,{children:Object(d.jsx)(l.a.Title,{children:"Importing Data..."})}),Object(d.jsx)(l.a.Body,{children:Object(d.jsxs)("div",{className:"d-grid gap-3",children:[Object(d.jsx)(m,{progress:this.props.proteinProgress,error:this.props.proteinError,label:"Decode Protein TIFF..."}),Object(d.jsx)(m,{progress:this.props.segmentationProgress,error:this.props.segmentationError,label:"Decode Segmentation TIFF..."}),Object(d.jsx)(m,{progress:this.props.sdfProgress,error:this.props.sdfError,label:"Compute Distance Fields..."})]})})]})}}]),n}(s.Component);t.a=p},162:function(e,t,n){},166:function(e,t,n){e.exports=n.p+"static/js/sdf-worker.d17a835f.chunk.worker.js"},171:function(e,t,n){e.exports=n.p+"static/js/tiff-worker.a6adfe81.chunk.worker.js"},285:function(e,t){e.exports="in vec4 position;\nuniform mat4 modelview;\nuniform mat4 proj;\nuniform vec3 cameraPos;\nout vec3 vOrigin;\nout vec3 vDirection;\n\nvoid main() {\n    vOrigin = vec3( inverse( modelview ) * vec4( 0.0, 0.0, 0.0, 1.0 ) ).xyz;\n    vDirection = position.xyz - vOrigin;\n    gl_Position = proj * modelview * position;\n}"},286:function(e,t){e.exports="precision highp float;\nprecision highp sampler3D;\n\nout vec4 FragColor;\n\nuniform sampler3D volume0;\nuniform sampler3D volume1;\nuniform sampler3D volume2;\nuniform sampler3D volume3;\nuniform sampler3D volume4;\nuniform sampler3D volume5;\nuniform sampler3D volume6;\nuniform sampler3D volume7;\nuniform sampler3D volume8;\nuniform sampler3D volume9;\n\nuniform sampler3D sdf;\n\nuniform sampler2D texDepth;\n\nuniform sampler2D selection;\nuniform sampler2D projection;\n\nuniform mat4 modelview;\nuniform mat4 proj;\n\nuniform vec3 volumeSize;\nuniform vec2 resolution;\n\nuniform float isovalue;\n\nuniform bool displayProtein;\nuniform bool displayCompartments;\nuniform bool useLod;\n\nuniform bool debugSamples;\n\nin vec3 vOrigin;\nin vec3 vDirection;\n\nvec2 rayBoxDst(vec3 bmin, vec3 bmax, vec3 p, vec3 d) {\n    vec3 t0 = (bmin - p) / d;\n    vec3 t1 = (bmax - p) / d;\n    vec3 tmin = min(t0, t1);\n    vec3 tmax = max(t0, t1);\n\n    float dstA = max(max(tmin.x, tmin.y), tmin.z);\n    float dstB = min(tmax.x, min(tmax.y, tmax.z));\n\n    float dstToBox = max(0.0, dstA);\n    float dstInsideBox = max(0.0, dstB - dstToBox);\n    return vec2(dstToBox, dstInsideBox);\n}\n\n// https://github.com/kbinani/colormap-shaders/blob/master/shaders/glsl/MATLAB_summer.frag\nvec3 colormap(float x) {\n    return vec3(clamp(x, 0.0, 1.0), clamp(0.5 * x + 0.5, 0.0, 1.0), 0.4);\n}\n\nvec3 matlab_spring(float x) {\n    return vec3(1.0, clamp(x, 0.0, 1.0), clamp(1.0 - x, 0.0, 1.0));\n}\n\n// Sample the protein channel, local coordinates.\nvec2 sampleProtein(vec3 p, int lod) {\n    if (lod == 0) {\n        return texture(volume0, p/volumeSize + 0.5).rg;\n    } else if (lod == 1) {\n        return texture(volume1, p/volumeSize + 0.5).rg;\n    } else if (lod == 2) {\n        return texture(volume2, p/volumeSize + 0.5).rg;\n    } else if (lod == 3) {\n        return texture(volume3, p/volumeSize + 0.5).rg;\n    } else if (lod == 4) {\n        return texture(volume4, p/volumeSize + 0.5).rg;\n    } else if (lod == 5) {\n        return texture(volume5, p/volumeSize + 0.5).rg;\n    } else if (lod == 6) {\n        return texture(volume6, p/volumeSize + 0.5).rg;\n    } else if (lod == 7) {\n        return texture(volume7, p/volumeSize + 0.5).rg;\n    } else if (lod == 8) {\n        return texture(volume8, p/volumeSize + 0.5).rg;\n    } else {\n        return texture(volume9, p/volumeSize + 0.5).rg;\n    }\n}\n\nfloat sampleSdf(vec3 p) {\n    return texture(sdf, p/volumeSize + 0.5).r * 255.0 / 10.0 - 5.0;;\n}\n\nvoid calcNormalAndCurv(vec3 p, out vec3 normal, out float curv) {\n    float h = 0.01; \n    vec2 k = h * vec2(1., 0.);\n\n    float t1 = sampleSdf(p + volumeSize*k.xyy); float t2 = sampleSdf(p - volumeSize*k.xyy);\n    float t3 = sampleSdf(p + volumeSize*k.yxy); float t4 = sampleSdf(p - volumeSize*k.yxy);\n    float t5 = sampleSdf(p + volumeSize*k.yxx); float t6 = sampleSdf(p - volumeSize*k.yxx);\n\n    curv = (t1+t2+t3+t4+t5+t6-6.0*sampleSdf(p))/(h*h);\n    normal = normalize(k.xyy * (t1-t2) + k.yxy * (t3-t4) + k.yyx * (t5-t6));\n}\n\n\nvoid main()\n{\n    float normalizedDepth = texture(texDepth, gl_FragCoord.xy / resolution).r;\n    vec4 ndc = vec4(gl_FragCoord.xy / resolution * 2.0 - 1.0,\n                    normalizedDepth * 2.0 - 1.0, 1.0f);\n\n    vec4 vcoords = inverse(proj) * ndc;\n    vcoords /= vcoords.w;\n    float depth = -vcoords.z;\n\n    vec3 rayDir = normalize( vDirection );\n    vec2 boxDst = rayBoxDst(-0.5 * volumeSize, 0.5 * volumeSize, vOrigin, rayDir);\n\n    // Render render isosurface\n    vec4 surfaceColor = vec4(0.0f);\n    vec4 proteinColor = vec4(0.0f);\n    \n    if (displayCompartments) {\n        vec3 rayPos = vOrigin + boxDst.x * rayDir;\n        float dist = 0.0;\n        while (dist < boxDst.y) {\n            if (dist + boxDst.x > depth) break;\n            // Simple sphere tracer.            \n            float sdfVal = sampleSdf(rayPos);\n            \n            if (sdfVal < 0.01) {\n                float curv;\n                vec3 normal;\n                calcNormalAndCurv(rayPos, normal, curv);\n                float ldn = dot(normal, vec3(1.0, 0.0, 0.0));\n                surfaceColor = mix(vec4(0.0, 0.0, 0.0, 1.0), vec4(colormap(abs(0.00001*curv)), 1.0), 0.5 + 0.5 * ldn);\n                break;\n            }\n\n            dist += sdfVal;\n            rayPos += sdfVal * rayDir;\n        }\n        depth = min(depth, boxDst.x + dist);\n    }\n\n    // Render volume.\n    float steps = 0.0;\n    vec3 rayPos = vOrigin + boxDst.x * rayDir;\n\n    float baseStepSize = 0.25;\n    float dist = 0.0;\n\n    // This works better than an if statement for some reason (at least on Intel GPUs)\n    float dstToMarch = float(displayProtein)*boxDst.y;\n\n    while (dist < dstToMarch) {\n        float sdfVal = sampleSdf(rayPos);\n\n        float stepSize = baseStepSize;\n        if (sdfVal < isovalue) {\n            int lod = 0;\n            \n            if (useLod) {\n                if (dist + boxDst.x < 40.0) {\n                    lod = 0;\n                    stepSize = baseStepSize;\n                } else if (dist + boxDst.x < 80.0) {\n                    lod = 1;\n                    stepSize = baseStepSize * 2.0;\n                } else if (dist + boxDst.x < 160.0) {\n                    lod = 2;\n                    stepSize = baseStepSize * 4.0;\n                } else {\n                    lod = 3;\n                    stepSize = baseStepSize * 8.0;\n                }\n            }\n\n            float density = 0.75 * sampleProtein(rayPos, lod).r;\n            vec3 color = colormap(density);\n\n            vec3 uvw = rayPos / volumeSize + 0.5;\n            float distanceToMaximum = clamp(1.0 - abs(uvw.z - texture(projection, uvw.xy).g) / 0.025, 0.0, 1.0);\n            float selectionMask = texture(selection, uvw.xy).r;\n\n            float highlight = distanceToMaximum * selectionMask;\n            color = mix(color, 3.0 * matlab_spring(density), highlight);\n\n            proteinColor.rgb += density * (1.0 - proteinColor.a) * color;\n            proteinColor.a += density * (1.0 - proteinColor.a);\n        }\n\n        dist += stepSize;\n        rayPos += stepSize * rayDir;\n\n        steps += 1.0;\n\n        if (proteinColor.a > 0.99f) break;\n        if (dist + boxDst.x > depth) break;\n    }\n\n    if (debugSamples) {\n        FragColor.rgb = matlab_spring(steps / 500.0);\n        FragColor.a = 1.0;\n    } else {\n        FragColor.rgb = mix(surfaceColor.rgb, proteinColor.rgb, proteinColor.a);\n        FragColor.a = max(surfaceColor.a, proteinColor.a);\n    }\n}"},287:function(e,t){e.exports="varying vec2 vUv;\n\nvoid main() {\n    vUv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}"},288:function(e,t){e.exports="\nvarying vec2 vUv;\n\nuniform sampler2D texGrid;\nuniform sampler2D texVolume;\n\nvoid main() {\n    gl_FragColor = vec4(mix(texture(texGrid, vUv).rgb, texture(texVolume, vUv).rgb, texture(texVolume, vUv).a), 1.0);\n}"},289:function(e,t){e.exports="varying vec2 vUv;\n\nvoid main() {\n    vUv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}"},290:function(e,t){e.exports="varying vec2 vUv;\n\nuniform highp sampler3D volume;\nuniform highp sampler3D sdf;\nuniform float isovalue;\n\nvoid main() {\n    vec3 uv = vec3(vUv, 0.0);\n    int col = textureSize(volume, 0).z;\n\n    // Maximum projection.\n    float maxDensity = 0.0;\n    float maxPos = 0.0;\n    for (float i = 0.0; i < float(col); i += 1.0) {\n        uv.z = i / float(col);\n        float sdfVal = texture(sdf, uv).r * 255.0 / 10.0 - 5.0 - isovalue;\n        if (sdfVal <= 0.01) {\n            float density = texture(volume, uv).r;\n            if (density > maxDensity) {\n                maxDensity = density;\n                maxPos = uv.z;\n            }\n        }\n    }\n\n    gl_FragColor = vec4(maxDensity, maxPos, 0.0, 1.0);\n}"},291:function(e,t){e.exports="varying vec2 vUv;\n\nvoid main() {\n    vUv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}"},292:function(e,t){e.exports="varying vec2 vUv;\n\nuniform bool clear;\nuniform vec2 lastPosition;\nuniform vec2 position;\nuniform bool depressed;\nuniform float resolution;\nuniform int penMode;\nuniform float penSize;\nuniform sampler2D restore;\nuniform bool doRestore;\n\n// https://iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm\nfloat sdSegment( in vec2 p, in vec2 a, in vec2 b )\n{\n    vec2 pa = p-a, ba = b-a;\n    float h = clamp( dot(pa,ba)/dot(ba,ba), 0.0, 1.0 );\n    return length( pa - ba*h );\n}\n\nvoid drawPixel() {\n    gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n}\n\nvoid erasePixel() {\n    gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n}\n\nvoid main()\n{\n    if (clear) {\n        erasePixel();\n        return;\n    }\n\n    if (doRestore) {\n        gl_FragColor = texture(restore, vUv);\n        return;\n    }\n\n    if (sdSegment(vUv, position, lastPosition) < penSize/resolution && depressed) {\n        if (penMode == 0) {\n            drawPixel();\n        } else {\n            erasePixel();\n        }\n    } else {\n        discard;\n    }\n}"},293:function(e,t){e.exports="varying vec2 vUv;\n\nvoid main() {\n    vUv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}"},294:function(e,t){e.exports="varying vec2 vUv;\n\nuniform highp sampler2D projection;\nuniform highp sampler2D selection;\n\n// https://github.com/kbinani/colormap-shaders/blob/master/shaders/glsl/MATLAB_summer.frag\nvec4 colormap(float x) {\n    return vec4(clamp(x, 0.0, 1.0), clamp(0.5 * x + 0.5, 0.0, 1.0), 0.4, 1.0);\n}\n\nvoid main() {\n    vec4 c1 = colormap(texture(projection, vUv).r);\n    vec4 c2 = texture(selection, vUv);\n\n    gl_FragColor = mix(0.5*c1, c1, c2.r);\n    //gl_FragColor = vec4(vUv.x, vUv.y, 0.0, 1.0);\n}"},295:function(e,t,n){"use strict";n.r(t);var i=n(0),r=n.n(i),a=n(33),o=n.n(a),s=(n(162),n(116),n(163),n(164),n(165),n(2)),l=n(3),c=n(15),u=n(4),d=n(5),h=n(144),m=n(20),p=n(42),f=n(90),v=n(1),b=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){var e;return e=this.props.fullscreen?"bi-fullscreen-exit":"bi-arrows-fullscreen",Object(v.jsxs)(f.a,{className:"justify-content-between",children:[Object(v.jsxs)(p.a,{children:[Object(v.jsx)(m.a,{onClick:this.props.onToggleSidebar,children:Object(v.jsx)("i",{className:"bi-tools"})}),Object(v.jsx)(m.a,{onClick:this.props.onImportData,children:"Import Data"})]}),Object(v.jsx)(p.a,{children:Object(v.jsx)(m.a,{onClick:this.props.onToggleFullscreen,children:Object(v.jsx)("i",{className:e})})})]})}}]),n}(i.Component),g=b,j=n(85),x=n(156),y=n(114),S=n(60),w=n(18),O=n(148),k=function(e){for(var t=function(t){e.onCompartmentSelection(t)},n=[Object(v.jsx)(S.a.Item,{onClick:function(){return t(0)},children:"All Compartments"})],i=function(){var e=r;n.push(Object(v.jsxs)(S.a.Item,{onClick:function(){return t(e+1)},children:["Compartment ",e+1]}))},r=0;r<e.numCompartments-1;++r)i();var a="";return a=0===e.numCompartments?"No Compartment Data":0===e.selection?"All Compartments":"Compartment "+e.selection,Object(v.jsx)(O.a,{md:3,children:Object(v.jsx)(j.a,{children:Object(v.jsx)(x.a,{in:e.open,children:Object(v.jsx)(y.a,{children:Object(v.jsx)(y.a.Body,{children:Object(v.jsxs)(w.a,{children:[Object(v.jsxs)(w.a.Check,{className:"form-switch",children:[Object(v.jsx)(w.a.Check.Input,{checked:e.displayProtein,disabled:0===e.numCompartments,onChange:function(t){e.onDisplayProtein(t.target.checked)}}),Object(v.jsx)(w.a.Check.Label,{children:"Display Protein"})]}),Object(v.jsxs)(w.a.Check,{className:"form-switch",children:[Object(v.jsx)(w.a.Check.Input,{checked:e.displaySegmentation,disabled:0===e.numCompartments,onChange:function(t){e.onDisplaySegmentation(t.target.checked)}}),Object(v.jsx)(w.a.Check.Label,{children:"Display Segmentation"})]}),Object(v.jsx)(w.a.Range,{disabled:0===e.numCompartments,onChange:function(t){e.onIsovalue(t.target.value)}}),Object(v.jsxs)(S.a,{children:[Object(v.jsx)(S.a.Toggle,{disabled:0===e.numCompartments,children:a}),Object(v.jsx)(S.a.Menu,{children:n})]}),"Debug Options",Object(v.jsxs)(w.a.Check,{className:"form-switch",children:[Object(v.jsx)(w.a.Check.Input,{checked:e.debugSamples,onChange:function(t){e.onDebugSamples(t.target.checked)}}),Object(v.jsx)(w.a.Check.Label,{children:"Display Texture Samples"})]}),Object(v.jsxs)(w.a.Check,{className:"form-switch",children:[Object(v.jsx)(w.a.Check.Input,{checked:e.useLod,onChange:function(t){e.onUseLod(t.target.checked)}}),Object(v.jsx)(w.a.Check.Label,{children:"Use LoD"})]})]})})})})})})},C=function(e){return Object(v.jsx)("div",{className:"overlay fill-screen d-grid gap-3",children:e.children})},P=n(153),D=function(e){var t={labels:e.labelsHistogram,datasets:[{backgroundColor:"rgb(255, 99, 132)",borderColor:"rgb(255, 99, 132)",data:e.globalHistogram,label:"Global Histogram"},{backgroundColor:"rgb(0, 255, 132)",borderColor:"rgb(0, 255, 132)",data:e.localHistogram,label:"Local Histogram"}]};return Object(v.jsx)(v.Fragment,{children:Object(v.jsx)(P.a,{className:"plots",data:t,options:{scales:{yAxes:[{ticks:{beginAtZero:!0}}]},maintainAspectRatio:!1}})})},z=n(14),V=n(64),T=n(83),M=function(e){var t=Object(i.useRef)(),n=Object(i.useState)(!1),r=Object(z.a)(n,2),a=r[0],o=r[1],s=Object(i.useState)(""),l=Object(z.a)(s,2),c=l[0],u=l[1],d=Object(i.useState)(!1),h=Object(z.a)(d,2),p=h[0],f=h[1];Object(i.useEffect)((function(){t.current&&a&&(t.current.focus(),t.current.value=c)}),[a,c,t]);var b,g=function(t){o(t),u(e.label)};return b=!0===a?Object(v.jsx)(T.a,{style:{marginLeft:"auto"},onKeyPress:function(e){"Enter"===e.key&&g(!1)},onChange:function(t){e.onLabel(t.target.value)},onBlur:function(){p||g(!1)},ref:t}):Object(v.jsx)(m.a,{style:{marginLeft:"auto"},onClick:e.onClick,children:e.label}),Object(v.jsxs)(V.a,{children:[b,Object(v.jsx)(m.a,{onClick:function(){g(!a)},onMouseEnter:function(){return f(!0)},onMouseLeave:function(){return f(!1)},children:Object(v.jsx)("i",{className:"bi-tag-fill"})}),Object(v.jsx)(m.a,{onClick:e.onExport,children:Object(v.jsx)("i",{className:"bi-download"})}),Object(v.jsx)(m.a,{onClick:e.onDelete,children:Object(v.jsx)("i",{className:"bi-trash-fill"})})]})},I=n(17),F=n.n(I),E=n(24),U=n(9),N=n(151),L=function(){function e(){Object(s.a)(this,e)}return Object(l.a)(e,[{key:"render",value:function(){}},{key:"setVolumeSize",value:function(e,t,n){}},{key:"setProteinData",value:function(e){}},{key:"setDistanceData",value:function(e){}},{key:"setIsovalue",value:function(e){}},{key:"setCompartmentIndex",value:function(e){}},{key:"setDisplayCompartments",value:function(e){}},{key:"setDisplayProtein",value:function(e){}},{key:"resizeCallback",value:function(){}},{key:"setSkeleton",value:function(e){}},{key:"selectionUpdated",value:function(){}},{key:"setDebugSamples",value:function(e){}},{key:"setUseLod",value:function(e){}}]),e}(),R=n(91);U.n.DefaultUp=new U.E(0,0,1);var A,B,H,_,G=function(e){Object(u.a)(i,e);var t=Object(d.a)(i);function i(e,r){var a;Object(s.a)(this,i),(a=t.call(this)).dom=r,a.renderer=e,a.camera=new U.p(75,r.clientWidth/r.clientHeight,.1,5e3),a.controls=new R.a(a.camera,r),a.camera.position.y=-85,a.controls.update(),a.materialMarchVolume=new U.v({glslVersion:U.i,uniforms:{modelview:{value:a.camera.matrixWorldInverse},proj:{value:a.camera.projectionMatrix},resolution:{value:new U.D(0,0)},volume0:{value:null},volume1:{value:null},volume2:{value:null},volume3:{value:null},volume4:{value:null},volume5:{value:null},volume6:{value:null},volume7:{value:null},volume8:{value:null},volume9:{value:null},volumeSize:{value:null},texDepth:{value:null},sdf:{value:null},isovalue:{value:null},displayProtein:{value:!1},displayCompartments:{value:!1},selection:{value:!1},projection:{value:!1},debugSamples:{value:!1},useLod:{value:!0}},vertexShader:n(285),fragmentShader:n(286),side:U.a,transparent:!0}),a.materialCompose=new U.z({vertexShader:n(287),fragmentShader:n(288),uniforms:{texGrid:{value:null},texVolume:{value:null}},transparent:!0}),a.sceneGrid=new U.y;a.grid=new U.j(10,10),a.grid.rotateX(.5*Math.PI),a.sceneGrid.add(a.grid),a.grid.onBeforeRender=function(e,t,n,i,r,o){var s=a.controls.target;a.grid.position.x=s.x,a.grid.position.y=s.y,a.grid.position.z=s.z,a.grid.updateMatrixWorld()};var o=new U.b;a.sceneVolume=new U.y,a.box=new U.m(o,a.materialMarchVolume),a.sceneVolume.add(a.box),a.sceneCompose=new U.y,a.cameraCompose=new U.o(-1,1,1,-1,0,1);var l=new U.q(2,2),c=new U.m(l,a.materialCompose);return a.sceneCompose.add(c),a.renderTargetVolume=new U.F(0,0),a.renderTargetGrid=new U.F(0,0),a.renderTargetGrid.depthTexture=new U.g,a.materialMarchVolume.uniforms.texDepth.value=a.renderTargetGrid.depthTexture,a.materialCompose.uniforms.texGrid.value=a.renderTargetGrid.texture,a.materialCompose.uniforms.texVolume.value=a.renderTargetVolume.texture,a.volumeDirty=!0,a.controls.addEventListener("change",(function(){a.volumeDirty=!0})),window.addEventListener("resize",(function(){a.resizeCallback()})),a.resizeCallback(),a}return Object(l.a)(i,[{key:"render",value:function(){if(this.volumeTexture&&this.sdfTextures&&this.volumeDirty){var e=this.dom.getBoundingClientRect(),t=e.right-e.left,n=e.bottom-e.top,i=e.left,r=window.innerHeight-e.bottom;this.renderer.setViewport(i,r,t,n),this.renderer.setScissor(i,r,t,n),this.renderer.setScissorTest(!0),this.controls.update();var a=this.renderer.getContext();this.renderer.setRenderTarget(this.renderTargetGrid),a.clear(a.COLOR_BUFFER_BIT),this.renderer.render(this.sceneGrid,this.camera),this.renderer.setRenderTarget(this.renderTargetVolume),a.clear(a.COLOR_BUFFER_BIT),this.renderer.render(this.sceneVolume,this.camera),this.renderer.setRenderTarget(null),a.clear(a.COLOR_BUFFER_BIT),this.renderer.render(this.sceneCompose,this.cameraCompose),this.volumeDirty=!1}}},{key:"selectionUpdated",value:function(){this.volumeDirty=!0}},{key:"setVolumeSize",value:function(e,t,n){this.volumeSize=new U.E(e,t,n),this.box.geometry=new U.b(this.volumeSize.x,this.volumeSize.y,this.volumeSize.z),this.materialMarchVolume.uniforms.volumeSize.value=this.volumeSize,this.volumeDirty=!0}},{key:"setProteinData",value:function(e){this.volumeTexture=e;for(var t=0;t<9;++t)this.materialMarchVolume.uniforms["volume"+t].value=this.volumeTexture[t];this.volumeDirty=!0}},{key:"setDistanceData",value:function(e,t){this.sdfTextures=e,this.materialMarchVolume.uniforms.sdf.value=this.sdfTextures[0],this.volumeDirty=!0}},{key:"setIsovalue",value:function(e){this.materialMarchVolume.uniforms.isovalue.value=e}},{key:"setCompartmentIndex",value:function(e){this.materialMarchVolume.uniforms.sdf.value=this.sdfTextures[e],this.volumeDirty=!0}},{key:"setDisplayCompartments",value:function(e){this.materialMarchVolume.uniforms.displayCompartments.value=e,this.volumeDirty=!0}},{key:"setDisplayProtein",value:function(e){this.materialMarchVolume.uniforms.displayProtein.value=e,this.volumeDirty=!0}},{key:"setSelectionTexture",value:function(e){this.materialMarchVolume.uniforms.selection.value=e,this.volumeDirty=!0}},{key:"setProjectionTexture",value:function(e){this.materialMarchVolume.uniforms.projection.value=e,this.volumeDirty=!0}},{key:"resizeCallback",value:function(){this.renderer.setSize(window.innerWidth,window.innerHeight);var e=this.dom.getBoundingClientRect(),t=e.right-e.left,n=e.bottom-e.top;this.camera.aspect=t/n,this.camera.updateProjectionMatrix(),this.renderTargetVolume.setSize(t,n),this.renderTargetGrid.setSize(t,n),this.materialMarchVolume.uniforms.resolution.value=new U.D(t,n),this.renderTargetGrid.depthTexture=new U.g,this.materialMarchVolume.uniforms.texDepth.value=this.renderTargetGrid.depthTexture,this.volumeDirty=!0}},{key:"setSkeleton",value:function(e){var t=new U.d;t.setAttribute("position",new U.c(e,3));var n=new U.r(t);n.position.x=-.5*this.volumeSize.x,n.position.y=-.5*this.volumeSize.y,n.position.z=-.5*this.volumeSize.z,this.sceneGrid.add(n)}},{key:"setDebugSamples",value:function(e){this.materialMarchVolume.uniforms.debugSamples.value=e}},{key:"setUseLod",value:function(e){this.materialMarchVolume.uniforms.useLod.value=e}}]),i}(L),q=function(){function e(t,i,r){var a=this;Object(s.a)(this,e),this.dom=i,this.renderer=t,this.onSelectionUpdated=r,this.materialProjection=new U.z({vertexShader:n(289),fragmentShader:n(290),uniforms:{volume:{value:null},sdf:{value:null},isovalue:{value:null}},transparent:!0}),this.materialSelection=new U.z({vertexShader:n(291),fragmentShader:n(292),uniforms:{clear:{value:!0},lastPosition:{value:new U.D(0,0)},position:{value:new U.D(0,0)},depressed:{value:!1},penMode:{value:0},penSize:{value:8},resolution:{value:1024},restore:{value:null},doRestore:{value:!1}},transparent:!0}),this.materialMap=new U.z({vertexShader:n(293),fragmentShader:n(294),uniforms:{selection:{value:null},projection:{value:null}},transparent:!0}),this.renderTargetSelection=new U.F(1024,1024),this.renderTargetProjection=new U.F(1024,1024);var o=i.clientWidth/i.clientHeight;this.camera=new U.o(-o,o,1,-1,0,2),this.controls=new R.a(this.camera,i),this.camera.position.z=1,this.controls.enableRotate=!1,this.controls.update(),this.cameraProjection=new U.o(-1,1,1,-1,0,2),this.sceneProjection=new U.y;var l=new U.q(2,2),c=new U.m(l,this.materialProjection);this.planeMap=c,this.sceneProjection.add(c),this.cameraSelection=new U.o(-1,1,1,-1,0,2),this.sceneSelection=new U.y;var u=new U.q(2,2),d=new U.m(u,this.materialSelection);this.sceneSelection.add(d),this.sceneMap=new U.y;var h=new U.q(2,2),m=new U.m(h,this.materialMap);this.sceneMap.add(m),this.sceneMap.add(this.camera),this.materialMap.uniforms.projection.value=this.renderTargetProjection.texture,this.materialMap.uniforms.selection.value=this.renderTargetSelection.texture,this.projectionDirty=!1,this.selectionDirty=!1,this.dom.addEventListener("mousemove",(function(e){a.mouseMove(e)})),this.dom.addEventListener("mousedown",(function(e){a.mouseDown(e)})),this.dom.addEventListener("mouseup",(function(e){a.mouseUp(e)})),this.dom.addEventListener("mouseout",(function(e){a.mouseOut(e)})),window.addEventListener("resize",(function(){a.resizeCallback()})),this.resizeCallback()}return Object(l.a)(e,[{key:"getMousePosition",value:function(e){var t=new U.w,n=new U.D,i=this.dom.getBoundingClientRect();n.x=(e.clientX-i.left)/(i.right-i.left)*2-1,n.y=1-(e.clientY-i.top)/(i.bottom-i.top)*2,t.setFromCamera(n.clone(),this.camera);var r=t.intersectObject(this.planeMap);return r.length>0?r[0].uv:null}},{key:"mouseDown",value:function(e){if(0===e.button){var t=this.getMousePosition(e);t&&(this.materialSelection.uniforms.position.value=t,this.materialSelection.uniforms.lastPosition.value=this.materialSelection.uniforms.position.value,this.selectionDirty=!0,this.materialSelection.uniforms.depressed.value=!0)}}},{key:"mouseMove",value:function(e){if(0===e.button&&this.materialSelection.uniforms.depressed.value){var t=this.getMousePosition(e);t&&(this.materialSelection.uniforms.lastPosition.value=this.materialSelection.uniforms.position.value,this.materialSelection.uniforms.position.value=t,this.selectionDirty=!0)}}},{key:"mouseOut",value:function(e){0===e.button&&(this.materialSelection.uniforms.depressed.value=!1)}},{key:"mouseUp",value:function(e){0===e.button&&(this.materialSelection.uniforms.depressed.value=!1)}},{key:"renderProjection",value:function(){this.renderer.setViewport(0,0,1024,1024),this.renderer.setScissorTest(!1),this.renderer.setRenderTarget(this.renderTargetProjection),this.renderer.render(this.sceneProjection,this.cameraProjection),this.projectionDirty=!1}},{key:"renderSelection",value:function(){this.renderer.setViewport(0,0,1024,1024),this.renderer.setScissorTest(!1),this.renderer.setRenderTarget(this.renderTargetSelection),this.renderer.render(this.sceneSelection,this.cameraSelection),this.materialSelection.uniforms.clear.value&&(this.materialSelection.uniforms.clear.value=!1),this.materialSelection.uniforms.doRestore.value&&(this.materialSelection.uniforms.doRestore.value=!1),this.onSelectionUpdated(),this.selectionDirty=!1}},{key:"renderMap",value:function(){var e=this.dom.getBoundingClientRect(),t=e.right-e.left,n=e.bottom-e.top,i=e.left,r=window.innerHeight-e.bottom;this.renderer.setViewport(i,r,t,n),this.renderer.setScissor(i,r,t,n),this.renderer.setScissorTest(!0),this.renderer.setRenderTarget(null);var a=this.renderer.getContext();a.clear(a.COLOR_BUFFER_BIT),this.renderer.render(this.sceneMap,this.camera)}},{key:"render",value:function(){this.selectionDirty&&this.renderSelection(),this.projectionDirty&&this.renderProjection(),this.renderMap()}},{key:"setVolumeSize",value:function(e,t,n){}},{key:"setProteinData",value:function(e){this.volumeTexture=e,this.materialProjection.uniforms.volume.value=this.volumeTexture,this.projectionDirty=!0}},{key:"setDistanceData",value:function(e){this.sdfTextures=e,this.materialProjection.uniforms.sdf.value=this.sdfTextures[0],this.projectionDirty=!0}},{key:"setIsovalue",value:function(e){this.materialProjection.uniforms.isovalue.value=e,this.projectionDirty=!0}},{key:"setCompartmentIndex",value:function(e){this.materialProjection.uniforms.sdf.value=this.sdfTextures[e],this.projectionDirty=!0}},{key:"setPenSize",value:function(e){this.materialSelection.uniforms.penSize.value=e}},{key:"setPenMode",value:function(e){this.materialSelection.uniforms.penMode.value="draw"===e?0:1}},{key:"getSeletionTexture",value:function(){return this.renderTargetSelection.texture}},{key:"getSelectionPixels",value:function(){var e={width:this.renderTargetSelection.width,height:this.renderTargetSelection.height,buffer:new Uint8Array(this.renderTargetSelection.width*this.renderTargetSelection.width*4)};return this.renderer.readRenderTargetPixels(this.renderTargetSelection,0,0,e.width,e.height,e.buffer),e}},{key:"setSelectionFromTexture",value:function(e){this.materialSelection.uniforms.doRestore.value=!0,this.materialSelection.uniforms.restore.value=e,this.selectionDirty=!0}},{key:"getProjectionPixels",value:function(){var e={width:this.renderTargetProjection.width,height:this.renderTargetProjection.height,buffer:new Uint8Array(this.renderTargetProjection.width*this.renderTargetProjection.width*4)};return this.renderer.readRenderTargetPixels(this.renderTargetProjection,0,0,e.width,e.height,e.buffer),e}},{key:"getProjectionTexture",value:function(){return this.renderTargetProjection.texture}},{key:"deleteSelection",value:function(){this.materialSelection.uniforms.clear.value=!0,this.selectionDirty=!0}},{key:"resizeCallback",value:function(){this.renderer.setSize(window.innerWidth,window.innerHeight);var e=this.dom.clientWidth/this.dom.clientHeight;this.camera.left=-e,this.camera.right=e,this.camera.updateProjectionMatrix()}}]),e}(),W=new N.a;W.showPanel(0),document.body.appendChild(W.dom);var X=null,Y=null;function Z(){return(Z=Object(E.a)(F.a.mark((function e(t,n,i){return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return A=t,B=n,H=i,(_=new U.G({canvas:A,preserveDrawingBuffer:!0})).autoClearColor=!1,e.next=7,J();case 7:Q();case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function J(){return K.apply(this,arguments)}function K(){return(K=Object(E.a)(F.a.mark((function e(){return F.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:X=new G(_,B),Y=new q(_,H,$),X.setSelectionTexture(Y.getSeletionTexture()),X.setProjectionTexture(Y.getProjectionTexture());case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Q(){requestAnimationFrame(Q),X.render(),Y.render(),W.update()}function $(){X.selectionUpdated()}var ee=n(152),te=n.n(ee),ne=n(97),ie=n(302),re=te.a.createInstance({name:"selectionStore",storeName:"storeData",description:"..."}),ae=function(e){var t=Object(i.useState)(20),n=Object(z.a)(t,2),r=n[0],a=n[1],o=Object(i.useState)("draw"),s=Object(z.a)(o,2),l=s[0],c=s[1],u=Object(i.useState)([]),d=Object(z.a)(u,2),h=d[0],b=d[1];Object(i.useEffect)((function(){x()}),[]);for(var g=function(e){c(e),function(e){Y&&Y.setPenMode(e)}(e)},j=function(e){var t;a(e),t=e,Y&&Y.setPenSize(t)},x=function(){var e={};re.iterate((function(t,n,i){e[n]=t.name})).then((function(){b(e)}))},y=function(e){re.getItem(e).then((function(e){!function(e,t,n){var i=new U.e(e,t,n,U.t);Y.setSelectionFromTexture(i)}(e.data,e.width,e.height)}))},S=[],w=function(){var e=Object(z.a)(k[O],2),t=e[0],n=e[1];S.push(Object(v.jsx)(M,{label:n,onClick:function(){return y(t)},onDelete:function(){return e=t,void re.removeItem(e).then(x);var e},onLabel:function(e){return function(e,t){re.getItem(e).then((function(n){n.name=t,re.setItem(e,n).then(x)}))}(t,e)},onExport:function(){return e=t,void re.getItem(e).then((function(e){console.log(e.data);var t=ne.encode([e.data.buffer],e.width,e.height,0),n=new Blob([t],{type:"image/png"}),i=URL.createObjectURL(n),r=document.createElement("a");r.href=i,r.download=e.name,r.click()}));var e}}))},O=0,k=Object.entries(h);O<k.length;O++)w();return Object(v.jsxs)("div",{className:"stack no-pointer-events",style:{position:"relative"},children:[Object(v.jsx)("div",{className:"overlay d-flex flex-column-reverse pointer-events",style:{overflowY:"overlay",height:"80%",right:0,bottom:0},children:Object(v.jsx)("div",{className:"align-self-end d-grid gap-2",children:S})}),Object(v.jsx)("div",{className:"overlay",children:Object(v.jsxs)(f.a,{style:{flexDirection:"column",width:"20pt"},children:[Object(v.jsx)(p.a,{vertical:!0,children:Object(v.jsx)(m.a,{onClick:function(){Y&&Y.deleteSelection()},children:Object(v.jsx)("i",{className:"bi-trash-fill"})})}),Object(v.jsx)("br",{}),Object(v.jsxs)(p.a,{vertical:!0,children:[Object(v.jsx)(m.a,{disabled:"draw"===l,onClick:function(){g("draw")},children:Object(v.jsx)("i",{className:"bi-pencil-fill"})}),Object(v.jsx)(m.a,{disabled:"erase"===l,onClick:function(){g("erase")},children:Object(v.jsx)("i",{className:"bi-eraser-fill"})})]}),Object(v.jsx)("br",{}),Object(v.jsxs)(p.a,{vertical:!0,children:[Object(v.jsx)(m.a,{disabled:40===r,onClick:function(){j(40)},children:Object(v.jsx)("i",{style:{fontSize:"8pt"},className:"bi-circle-fill"})}),Object(v.jsx)(m.a,{disabled:20===r,onClick:function(){j(20)},children:Object(v.jsx)("i",{style:{fontSize:"6pt"},className:"bi-circle-fill"})}),Object(v.jsx)(m.a,{disabled:10===r,onClick:function(){j(10)},children:Object(v.jsx)("i",{style:{fontSize:"4pt"},className:"bi-circle-fill"})})]}),Object(v.jsx)("br",{}),Object(v.jsxs)(p.a,{vertical:!0,children:[Object(v.jsx)(m.a,{onClick:function(){var e=Y.getSelectionPixels();re.setItem(Object(ie.a)(),{name:"New Selection",width:e.width,height:e.height,data:e.buffer}).then(x)},children:Object(v.jsx)("i",{className:"fas fa-save"})}),Object(v.jsx)(m.a,{onClick:function(){var e=document.createElement("input");e.type="file",e.onchange=function(e){var t=e.target.files[0];new Promise((function(e,n){var i=new FileReader;i.readAsArrayBuffer(t),i.onload=function(n){e([n.target.result,t.name.replace(".png","")])},i.onerror=function(e){n(i.error)},i.onabort=function(e){n("FileReader was aborted!")}})).then((function(e){var t=Object(z.a)(e,2),n=t[0],i=t[1],r=ne.decode(n),a=new Uint8Array(ne.toRGBA8(r)[0]);re.setItem(Object(ie.a)(),{name:i,width:r.width,height:r.height,data:a}).then(x)}))},e.click()},children:Object(v.jsx)("i",{className:"bi-upload"})})]})]})})]})},oe=function(e){var t=Object(i.useRef)(null),n=Object(i.useRef)(null),r=e.onMainView,a=e.onMapView;return Object(i.useEffect)((function(){r(t.current),a(n.current)}),[r,a]),Object(v.jsx)(v.Fragment,{children:Object(v.jsx)("div",{className:"views d-flex flex-col",children:Object(v.jsxs)("div",{className:"flex-fill d-flex flex-row",children:[Object(v.jsx)("div",{className:"flex-fill stack-base",children:Object(v.jsx)("div",{className:"stack",ref:t})}),Object(v.jsx)("div",{className:"v-divider"}),Object(v.jsxs)("div",{className:"flex-fill d-flex flex-column",children:[Object(v.jsxs)("div",{className:"flex-fill stack-base",children:[Object(v.jsx)("div",{className:"stack",ref:n}),Object(v.jsx)(ae,{})]}),Object(v.jsx)("div",{className:"h-divider"}),Object(v.jsx)("div",{className:"flex-fill",children:Object(v.jsx)(D,{localHistogram:e.localHistogram,globalHistogram:e.globalHistogram,labelsHistogram:e.labelsHistogram})})]})]})})})},se=function(e){var t=Object(i.useRef)(null);return Object(i.useEffect)((function(){e.ready&&e.mainView&&e.mapView&&function(e,t,n){Z.apply(this,arguments)}(t.current,e.mainView,e.mapView)}),[e.mainView,e.mapView,e.ready]),Object(i.useEffect)((function(){e.ready&&e.mainView&&e.mapView&&function(e,t){for(var n=[],i=0;i<e.length;++i){var r=new U.f(e[i],t[0],t[1],t[2]);r.format=U.x,r.minFilter=U.k,r.magFilter=U.k,r.unpackAlignment=1,n.push(r)}X.setDistanceData(n),Y.setDistanceData(n)}(e.sdf.buffers,e.sdf.dims)}),[e.sdf,e.mainView,e.mapView,e.ready]),Object(i.useEffect)((function(){e.ready&&e.mainView&&e.mapView&&function(e,t){for(var n=[],i=t[0],r=t[1],a=t[2],o=0;o<e.length;++o){var s=new U.f(e[o],i,r,a);s.format=U.u,s.type=U.C,s.internalFormat="RG8",s.minFilter=U.k,s.magFilter=U.k,s.generateMipmaps=!1,s.unpackAlignment=1,i=Math.ceil(i/2),r=Math.ceil(r/2),a=Math.ceil(a/2),n.push(s)}X.setProteinData(n),Y.setProteinData(n[0])}(e.protein.buffer,e.protein.dims)}),[e.protein,e.mainView,e.mapView,e.ready]),Object(i.useEffect)((function(){var t;e.ready&&e.mainView&&e.mapView&&(t=e.volumeSize,X.setVolumeSize(t[0],t[1],t[2]))}),[e.volumeSize,e.mainView,e.mapView,e.ready]),Object(i.useEffect)((function(){var t;e.ready&&e.mainView&&e.mapView&&(t=e.displayProtein,X.setDisplayProtein(t))}),[e.displayProtein,e.mainView,e.mapView,e.ready]),Object(i.useEffect)((function(){var t;e.ready&&e.mainView&&e.mapView&&(t=e.displaySegmentation,X.setDisplayCompartments(t))}),[e.displaySegmentation,e.mainView,e.mapView,e.ready]),Object(i.useEffect)((function(){var t;e.ready&&e.mainView&&e.mapView&&(t=e.compartmentIndex,X.setCompartmentIndex(t),Y.setCompartmentIndex(t))}),[e.compartmentIndex,e.mainView,e.mapView,e.ready]),Object(i.useEffect)((function(){var t;e.ready&&e.mainView&&e.mapView&&(t=e.debugSamples,X.setDebugSamples(t))}),[e.debugSamples,e.mainView,e.mapView,e.ready]),Object(i.useEffect)((function(){var t;e.ready&&e.mainView&&e.mapView&&(t=e.useLod,X.setUseLod(t))}),[e.useLod,e.mainView,e.mapView,e.ready]),Object(i.useEffect)((function(){var t;e.ready&&e.mainView&&e.mapView&&(t=e.isovalue,X.setIsovalue(t),Y.setIsovalue(t))}),[e.isovalue,e.mainView,e.mapView,e.ready]),Object(v.jsx)("canvas",{className:"renderer",ref:t})},le=function(e){Object(u.a)(n,e);var t=Object(d.a)(n);function n(e){var i;return Object(s.a)(this,n),(i=t.call(this,e)).state={fullscreen:!1,showSidebar:!1,showImport:!1,voxelSize:[0,0,0],sdf:{buffers:[],dims:[0,0,0]},protein:{buffer:[],dims:[0,0,0]},ready:!1,compartmentIndex:0,displaySegmentation:!0,displayProtein:!0,isovalue:0,globalHistogram:[],labelsHistogram:[],localHistogram:[],debugSamples:!1,useLod:!0,mainView:"",mapView:""},i.handleShowImport=i.handleShowImport.bind(Object(c.a)(i)),i.handleToggleFullscreen=i.handleToggleFullscreen.bind(Object(c.a)(i)),i.handleToggleSidebar=i.handleToggleSidebar.bind(Object(c.a)(i)),i.handleAbortImport=i.handleAbortImport.bind(Object(c.a)(i)),i.handleCompleteImport=i.handleCompleteImport.bind(Object(c.a)(i)),i.handleCompartmentSelection=i.handleCompartmentSelection.bind(Object(c.a)(i)),i.handleDisplaySegmentation=i.handleDisplaySegmentation.bind(Object(c.a)(i)),i.handleDisplayProtein=i.handleDisplayProtein.bind(Object(c.a)(i)),i.handleDebugSamples=i.handleDebugSamples.bind(Object(c.a)(i)),i.handleUseLod=i.handleUseLod.bind(Object(c.a)(i)),i.handleIsovalue=i.handleIsovalue.bind(Object(c.a)(i)),i.handleMainView=i.handleMainView.bind(Object(c.a)(i)),i.handleMapView=i.handleMapView.bind(Object(c.a)(i)),i}return Object(l.a)(n,[{key:"handleShowImport",value:function(){this.setState({showImport:!0})}},{key:"handleAbortImport",value:function(){this.setState({showImport:!1})}},{key:"handleMapView",value:function(e){this.setState({mapView:e})}},{key:"handleMainView",value:function(e){this.setState({mainView:e})}},{key:"handleCompleteImport",value:function(e,t,n,i,r,a){this.setState({sdf:{buffers:e,dims:n},protein:{buffer:t,dims:n},voxelSize:i,showImport:!1,ready:!0,globalHistogram:r,labelsHistogram:a})}},{key:"handleToggleFullscreen",value:function(){if(this.state.fullscreen)document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen();else{var e=document.documentElement;e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()}this.setState({fullscreen:!this.state.fullscreen})}},{key:"handleToggleSidebar",value:function(){this.setState({showSidebar:!this.state.showSidebar})}},{key:"handleCompartmentSelection",value:function(e){this.setState({compartmentIndex:e})}},{key:"handleDisplaySegmentation",value:function(e){this.setState({displaySegmentation:e})}},{key:"handleDisplayProtein",value:function(e){this.setState({displayProtein:e})}},{key:"handleDebugSamples",value:function(e){this.setState({debugSamples:e})}},{key:"handleUseLod",value:function(e){this.setState({useLod:e})}},{key:"handleIsovalue",value:function(e){this.setState({isovalue:e})}},{key:"render",value:function(){var e=[this.state.sdf.dims[0]*this.state.voxelSize[0],this.state.sdf.dims[1]*this.state.voxelSize[1],this.state.sdf.dims[2]*this.state.voxelSize[2]];return Object(v.jsxs)(v.Fragment,{children:[Object(v.jsx)("div",{className:"background"}),Object(v.jsx)(h.a,{show:this.state.showImport,onAbort:this.handleAbortImport,onComplete:this.handleCompleteImport}),!this.state.ready&&Object(v.jsx)("div",{className:"d-flex justify-content-center align-items-center",style:{position:"absolute",height:"100%",width:"100%"},children:Object(v.jsxs)(m.a,{variant:"primary",size:"lg",onClick:this.handleShowImport,children:[Object(v.jsx)("i",{className:"bi-plus-square"}),"\xa0\xa0Import Data"]})}),this.state.ready&&Object(v.jsxs)(v.Fragment,{children:[Object(v.jsx)(se,{mainView:this.state.mainView,mapView:this.state.mapView,sdf:this.state.sdf,protein:this.state.protein,volumeSize:e,displayProtein:this.state.displayProtein,displaySegmentation:this.state.displaySegmentation,compartmentIndex:this.state.compartmentIndex,ready:this.state.ready,debugSamples:this.state.debugSamples,useLod:this.state.useLod,isovalue:this.state.isovalue}),Object(v.jsxs)(C,{children:[Object(v.jsx)(g,{fullscreen:this.state.fullscreen,onImportData:this.handleShowImport,onToggleFullscreen:this.handleToggleFullscreen,onToggleSidebar:this.handleToggleSidebar}),Object(v.jsx)(k,{open:this.state.showSidebar,numCompartments:this.state.sdf.buffers.length,onCompartmentSelection:this.handleCompartmentSelection,selection:this.state.compartmentIndex,onDisplaySegmentation:this.handleDisplaySegmentation,onDisplayProtein:this.handleDisplayProtein,onDebugSamples:this.handleDebugSamples,onUseLod:this.handleUseLod,onIsovalue:this.handleIsovalue,displayProtein:this.state.displayProtein,displaySegmentation:this.state.displaySegmentation})]}),Object(v.jsx)(oe,{sdf:this.state.sdf,protein:this.state.protein,volumeSize:e,displayProtein:this.state.displayProtein,displaySegmentation:this.state.displaySegmentation,compartmentIndex:this.state.compartmentIndex,localHistogram:Array.from(this.state.localHistogram),globalHistogram:Array.from(this.state.globalHistogram),labelsHistogram:this.state.labelsHistogram,debugSamples:this.state.debugSamples,useLod:this.state.useLod,isovalue:this.state.isovalue,onMainView:this.handleMainView,onMapView:this.handleMapView})]})]})}}]),n}(i.Component);var ce=function(){return Object(v.jsx)("div",{className:"App",children:Object(v.jsx)(le,{})})},ue=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,303)).then((function(t){var n=t.getCLS,i=t.getFID,r=t.getFCP,a=t.getLCP,o=t.getTTFB;n(e),i(e),r(e),a(e),o(e)}))};o.a.render(Object(v.jsx)(r.a.StrictMode,{children:Object(v.jsx)(ce,{})}),document.getElementById("root")),ue()}},[[295,1,2]]]);
//# sourceMappingURL=main.3b1eb1ea.chunk.js.map