(this["webpackJsonppan-vision-viewer"]=this["webpackJsonppan-vision-viewer"]||[]).push([[0],{107:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return d}));var r=n(17),a=n.n(r),o=n(23),i=n(1),s=n(3),l=n(140),c=n(46),d=function(){function t(){Object(i.a)(this,t),this.buffer=null,this.pixels=new Uint8Array,this.width=0,this.height=0,this.depth=0,this.bits=0}return Object(s.a)(t,[{key:"open",value:function(){var e=Object(o.a)(a.a.mark((function e(t){var n,r,o,i,s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e,n){var r=new FileReader;r.readAsArrayBuffer(t),r.onload=function(t){e(t.target.result)},r.onerror=function(e){n(r.error)},r.onabort=function(e){n("FileReader was aborted!")}}));case 2:if(n=e.sent,r=l.decode(n),0!==Object.keys(r[0]).length){e.next=6;break}throw new Error("Could not decode TIFF file!");case 6:if(c=r[0],1===(o={t256:c.t256,t257:c.t257,t258:c.t258,t277:c.t277}).t277){e.next=9;break}throw new Error("Only grayscale images are supported.");case 9:if(8===o.t258){e.next=11;break}throw new Error("Only images with bit depth 8 are supported.");case 11:i=0;case 12:if(!(i<r.length)){e.next=19;break}if(a=r[i],s={t256:a.t256,t257:a.t257,t258:a.t258,t277:a.t277},JSON.stringify(o)===JSON.stringify(s)){e.next=16;break}throw new Error("Slice "+i+" has incorrect dimensions or pixel depth.");case 16:++i,e.next=12;break;case 19:this.buffer=n,this.width=o.t256[0],this.height=o.t257[0],this.depth=r.length,this.bits=o.t258[0];case 24:case"end":return e.stop()}var a,c}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"decode",value:function(){var t=Object(o.a)(a.a.mark((function t(n,r){var o;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=c.b(new Worker(e,{name:"tiff-worker",type:void 0})),t.next=3,o(this.buffer,c.a(n),c.a(r));case 3:this.pixels=t.sent;case 4:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()}]),t}()}).call(this,n(165))},111:function(e,t,n){},117:function(e,t){e.exports="in vec4 position;\nuniform mat4 modelview;\nuniform mat4 proj;\nuniform vec3 cameraPos;\nout vec3 vOrigin;\nout vec3 vDirection;\n\nvoid main() {\n    vOrigin = vec3( inverse( modelview ) * vec4( 0.0, 0.0, 0.0, 1.0 ) ).xyz;\n    vDirection = position.xyz - vOrigin;\n    gl_Position = proj * modelview * position;\n}"},138:function(e,t,n){"use strict";(function(e){var r=n(17),a=n.n(r),o=n(23),i=n(1),s=n(3),l=n(14),c=n(4),d=n(5),p=n(0),h=n(149),m=n(150),u=n(46),f=n(107),v=n(2),b=function(t){Object(c.a)(r,t);var n=Object(d.a)(r);function r(e){var t;return Object(i.a)(this,r),(t=n.call(this,e)).state={tiffProtein:"",tiffSegmentation:"",voxelSize:"",proteinProgress:0,segmentationProgress:0,sdfProgress:0,proteinError:"",segmentationError:"",sdfError:"",step:"dialog",preImportError:""},t.handleImport=t.handleImport.bind(Object(l.a)(t)),t.handleClose=t.handleClose.bind(Object(l.a)(t)),t.onProteinProgress=t.onProteinProgress.bind(Object(l.a)(t)),t.onSegmentationProgress=t.onSegmentationProgress.bind(Object(l.a)(t)),t.onProteinError=t.onProteinError.bind(Object(l.a)(t)),t.onSegmentationError=t.onSegmentationError.bind(Object(l.a)(t)),t.onSdfProgress=t.onSdfProgress.bind(Object(l.a)(t)),t.onSdfError=t.onSdfError.bind(Object(l.a)(t)),t}return Object(s.a)(r,[{key:"onProteinProgress",value:function(e){this.setState({proteinProgress:e})}},{key:"onSegmentationProgress",value:function(e){this.setState({segmentationProgress:e})}},{key:"onProteinError",value:function(e){this.setState({proteinError:e})}},{key:"onSegmentationError",value:function(e){this.setState({segmentationError:e})}},{key:"onSdfProgress",value:function(e){this.setState({sdfProgress:e})}},{key:"onSdfError",value:function(e){this.setState({sdfError:e})}},{key:"handleImport",value:function(){var t=Object(o.a)(a.a.mark((function t(n,r,o){var i,s,l,c,d,p,h,m,v,b,g,x,j,y,O,S=this;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=new f.a,s=new f.a,t.prev=2,t.next=5,i.open(n);case 5:return t.next=7,s.open(r);case 7:t.next=13;break;case 9:return t.prev=9,t.t0=t.catch(2),this.setState({preImportError:t.t0}),t.abrupt("return");case 13:if(i.width===s.width&&i.height===s.height&&i.depth===s.depth){t.next=16;break}return this.setState({preImportError:"Please make sure the protein and the segmentation data have the same dimensions."}),t.abrupt("return");case 16:return this.setState({step:"import",voxelSize:o,tiffProtein:i,tiffSegmentation:s,segmentationProgress:0,proteinProgress:0,sdfProgress:0,segmentationError:"",proteinError:"",sdfError:""}),t.next=19,i.decode(this.onProteinError,this.onProteinProgress);case 19:return t.next=21,s.decode(this.onSegmentationError,this.onSegmentationProgress);case 21:for(l=function(e,t){return Math.max(e,t)},c=s.pixels.reduce(l),d=[],p=new Array(c+1),h=function(){var t=m,n=function(e){p[t]=100*e,S.onSdfProgress(p.reduce((function(e,t){return e+t}),0)/(c+1))};d.push(new Promise((function(r,a){var i=new Worker(e,{name:"sdf-worker",type:void 0});r(u.b(i)(s,o,t,u.a(n)))})))},m=0;m<c+1;++m)h();return t.next=29,Promise.all(d);case 29:for(v=t.sent,this.onSdfProgress(100),8,b=new Float32Array(Math.pow(2,8)),g=new Float32Array(Math.pow(2,8)),x=0;x<v[0].length;++x)b[v[0][x]]+=i.pixels[x],g[v[0][x]]+=1;for(j=0;j<b.length;++j)b[j]=b[j]/g[j];for(y=[],O=0;O<256;++O)y.push(O/10-5);this.setState({step:"dialog"}),this.props.onComplete(v,i.pixels,[i.width,i.height,i.depth],[parseFloat(o.x),parseFloat(o.y),parseFloat(o.z)],b,y);case 40:case"end":return t.stop()}}),t,this,[[2,9]])})));return function(e,n,r){return t.apply(this,arguments)}}()},{key:"handleClose",value:function(){this.props.onAbort()}},{key:"render",value:function(){return Object(v.jsxs)(v.Fragment,{children:[Object(v.jsx)(h.a,{show:"dialog"===this.state.step&&this.props.show,error:this.state.preImportError,onImport:this.handleImport,onClose:this.handleClose}),Object(v.jsx)(m.a,{show:"import"===this.state.step&&this.props.show,proteinProgress:this.state.proteinProgress,segmentationProgress:this.state.segmentationProgress,sdfProgress:this.state.sdfProgress,proteinError:this.state.proteinError,segmentationError:this.state.segmentationError,sdfError:this.state.sdfError})]})}}]),r}(p.Component);t.a=b}).call(this,n(160))},149:function(e,t,n){"use strict";var r=n(17),a=n.n(r),o=n(23),i=n(1),s=n(3),l=n(14),c=n(4),d=n(5),p=n(0),h=n(81),m=n(33),u=n(27),f=n(20),v=n(106),b=n(2),g=function(e){Object(c.a)(n,e);var t=Object(d.a)(n);function n(e){var r;return Object(i.a)(this,n),(r=t.call(this,e)).handleChangeX=r.handleChangeX.bind(Object(l.a)(r)),r.handleChangeY=r.handleChangeY.bind(Object(l.a)(r)),r.handleChangeZ=r.handleChangeZ.bind(Object(l.a)(r)),r}return Object(s.a)(n,[{key:"handleChangeX",value:function(e){this.props.onChange({x:e.target.value,y:this.props.value.y,z:this.props.value.z})}},{key:"handleChangeY",value:function(e){this.props.onChange({x:this.props.value.x,y:e.target.value,z:this.props.value.z})}},{key:"handleChangeZ",value:function(e){this.props.onChange({x:this.props.value.x,y:this.props.value.y,z:e.target.value})}},{key:"render",value:function(){return Object(b.jsxs)(v.a,{className:"mb-3",children:[Object(b.jsx)(v.a.Text,{children:"Voxel Size"}),Object(b.jsx)(f.a.Control,{type:"number",placeholder:"x",value:this.props.value.x,onChange:this.handleChangeX}),Object(b.jsx)(f.a.Control,{type:"number",placeholder:"y",value:this.props.value.y,onChange:this.handleChangeY}),Object(b.jsx)(f.a.Control,{type:"number",placeholder:"z",value:this.props.value.z,onChange:this.handleChangeZ})]})}}]),n}(p.Component),x=function(e){Object(c.a)(n,e);var t=Object(d.a)(n);function n(e){var r;return Object(i.a)(this,n),(r=t.call(this,e)).state={fileProtein:"",fileSegmentation:"",voxelSize:{x:"",y:"",z:""},working:!1},r.handleClickImport=r.handleClickImport.bind(Object(l.a)(r)),r.handleChangeFileProtein=r.handleChangeFileProtein.bind(Object(l.a)(r)),r.handleChangeFileSegmentation=r.handleChangeFileSegmentation.bind(Object(l.a)(r)),r.handleChangeVoxelSize=r.handleChangeVoxelSize.bind(Object(l.a)(r)),r.handleClose=r.handleClose.bind(Object(l.a)(r)),r}return Object(s.a)(n,[{key:"handleChangeFileProtein",value:function(e){this.setState({fileProtein:e.target.files[0]})}},{key:"handleChangeFileSegmentation",value:function(e){this.setState({fileSegmentation:e.target.files[0]})}},{key:"handleChangeVoxelSize",value:function(e){this.setState({voxelSize:e})}},{key:"handleClickImport",value:function(){var e=Object(o.a)(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setState({working:!0}),this.props.onImport(this.state.fileProtein,this.state.fileSegmentation,this.state.voxelSize),this.setState({working:!1});case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleClose",value:function(e){this.props.onClose()}},{key:"render",value:function(){var e,t;return e=!(!(this.state.fileProtein&&this.state.fileSegmentation&&this.state.voxelSize.x&&this.state.voxelSize.y&&this.state.voxelSize.z)||this.state.working),this.props.error&&(t=Object(b.jsx)(h.a,{variant:"danger",children:this.props.error})),Object(b.jsxs)(u.a,{show:this.props.show,onHide:this.handleClose,children:[Object(b.jsx)(u.a.Header,{closeButton:!0,children:Object(b.jsx)(u.a.Title,{children:"Import Data"})}),Object(b.jsxs)(u.a.Body,{children:[Object(b.jsxs)(f.a,{children:[Object(b.jsxs)(f.a.Group,{className:"mb-3",children:[Object(b.jsx)(f.a.Label,{children:"Protein Data"}),Object(b.jsx)(f.a.Control,{type:"file",onChange:this.handleChangeFileProtein})]}),Object(b.jsxs)(f.a.Group,{className:"mb-3",children:[Object(b.jsx)(f.a.Label,{children:"Segmentation Data"}),Object(b.jsx)(f.a.Control,{type:"file",onChange:this.handleChangeFileSegmentation})]}),Object(b.jsx)(g,{value:this.state.voxelSize,onChange:this.handleChangeVoxelSize})]}),t]}),Object(b.jsx)(u.a.Footer,{children:Object(b.jsx)(m.a,{variant:"primary",disabled:!e,onClick:this.handleClickImport,children:"Import"})})]})}}]),n}(p.Component);t.a=x},150:function(e,t,n){"use strict";var r=n(1),a=n(3),o=n(4),i=n(5),s=n(0),l=n(27),c=(n(111),n(81)),d=n(110),p=n(2),h=function(e){Object(o.a)(n,e);var t=Object(i.a)(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(a.a)(n,[{key:"render",value:function(){var e="";this.props.progress>=100&&(e="success"),this.props.error&&(e="danger");var t,n=this.props.progress<100&&!this.props.error;return this.props.error&&(t=Object(p.jsx)(c.a,{variant:"danger",children:this.props.error})),Object(p.jsxs)("div",{className:"labeled-progress-bar",children:[Object(p.jsxs)(d.a,{children:[Object(p.jsx)("div",{className:"label-front",style:{clipPath:"inset(0 ".concat(100-this.props.progress,"% 0 0)")},children:this.props.label}),Object(p.jsx)("div",{className:"label-back",children:this.props.label}),Object(p.jsx)(d.a,{striped:!0,variant:e,animated:n,now:this.props.progress})]}),t]})}}]),n}(s.Component),m=h,u=function(e){Object(o.a)(n,e);var t=Object(i.a)(n);function n(e){var a;return Object(r.a)(this,n),(a=t.call(this,e)).state={proteinProgress:0,segmentationProgress:0,sdfProgress:0,proteinError:"",segmentationError:"",sdfError:""},a}return Object(a.a)(n,[{key:"componentDidMount",value:function(){}},{key:"componentWillUnmount",value:function(){}},{key:"render",value:function(){return Object(p.jsxs)(l.a,{backdrop:"static",show:this.props.show,children:[Object(p.jsx)(l.a.Header,{children:Object(p.jsx)(l.a.Title,{children:"Importing Data..."})}),Object(p.jsx)(l.a.Body,{children:Object(p.jsxs)("div",{className:"d-grid gap-3",children:[Object(p.jsx)(m,{progress:this.props.proteinProgress,error:this.props.proteinError,label:"Decode Protein TIFF..."}),Object(p.jsx)(m,{progress:this.props.segmentationProgress,error:this.props.segmentationError,label:"Decode Segmentation TIFF..."}),Object(p.jsx)(m,{progress:this.props.sdfProgress,error:this.props.sdfError,label:"Compute Distance Fields..."})]})})]})}}]),n}(s.Component);t.a=u},157:function(e,t,n){},160:function(e,t,n){e.exports=n.p+"static/js/sdf-worker.d19c0e83.chunk.worker.js"},165:function(e,t,n){e.exports=n.p+"static/js/tiff-worker.86009c6a.chunk.worker.js"},176:function(e,t){e.exports="precision highp float;\nprecision highp sampler3D;\n\nout vec4 FragColor;\n\nuniform sampler3D volume;\nuniform sampler3D sdf;\n\nuniform sampler2D texDepth;\n\nuniform sampler2D selection;\nuniform sampler2D projection;\n\nuniform mat4 modelview;\nuniform mat4 proj;\n\nuniform vec3 volumeSize;\nuniform vec2 resolution;\n\nuniform float isovalue;\n\nuniform bool displayProtein;\nuniform bool displayCompartments;\n\nin vec3 vOrigin;\nin vec3 vDirection;\n\nvec2 rayBoxDst(vec3 bmin, vec3 bmax, vec3 p, vec3 d) {\n    vec3 t0 = (bmin - p) / d;\n    vec3 t1 = (bmax - p) / d;\n    vec3 tmin = min(t0, t1);\n    vec3 tmax = max(t0, t1);\n\n    float dstA = max(max(tmin.x, tmin.y), tmin.z);\n    float dstB = min(tmax.x, min(tmax.y, tmax.z));\n\n    float dstToBox = max(0.0, dstA);\n    float dstInsideBox = max(0.0, dstB - dstToBox);\n    return vec2(dstToBox, dstInsideBox);\n}\n\n// https://github.com/kbinani/colormap-shaders/blob/master/shaders/glsl/MATLAB_summer.frag\nvec3 colormap(float x) {\n    return vec3(clamp(x, 0.0, 1.0), clamp(0.5 * x + 0.5, 0.0, 1.0), 0.4);\n}\n\nvec3 matlab_spring(float x) {\n    return vec3(1.0, clamp(x, 0.0, 1.0), clamp(1.0 - x, 0.0, 1.0));\n}\n\n// Sample the protein channel, local coordinates.\nfloat sampleProtein(vec3 p) {\n    return texture(volume, p/volumeSize + 0.5).r;\n}\n\nfloat sampleSdf(vec3 p) {\n    return texture(sdf, p/volumeSize + 0.5).r * 255.0 / 10.0 - 5.0;;\n}\n\nvoid calcNormalAndCurv(vec3 p, out vec3 normal, out float curv) {\n    float h = 0.01; \n    vec2 k = h * vec2(1., 0.);\n\n    float t1 = sampleSdf(p + volumeSize*k.xyy); float t2 = sampleSdf(p - volumeSize*k.xyy);\n    float t3 = sampleSdf(p + volumeSize*k.yxy); float t4 = sampleSdf(p - volumeSize*k.yxy);\n    float t5 = sampleSdf(p + volumeSize*k.yxx); float t6 = sampleSdf(p - volumeSize*k.yxx);\n\n    curv = (t1+t2+t3+t4+t5+t6-6.0*sampleSdf(p))/(h*h);\n    normal = normalize(k.xyy * (t1-t2) + k.yxy * (t3-t4) + k.yyx * (t5-t6));\n}\n\n\nvoid main()\n{\n    float normalizedDepth = texture(texDepth, gl_FragCoord.xy / resolution).r;\n    vec4 ndc = vec4(gl_FragCoord.xy / resolution * 2.0 - 1.0,\n                    normalizedDepth * 2.0 - 1.0, 1.0f);\n    vec4 vcoords = inverse(proj) * ndc;\n    vcoords /= vcoords.w;\n    float depth = -vcoords.z;\n\n    vec3 rayDir = normalize( vDirection );\n    vec2 boxDst = rayBoxDst(-0.5 * volumeSize, 0.5 * volumeSize, vOrigin, rayDir);\n\n    // Render render isosurface\n    vec4 surfaceColor = vec4(0.0f);\n    if (displayCompartments) {\n        vec3 rayPos = vOrigin + boxDst.x * rayDir;\n        float dist = 0.0;\n        while (dist < boxDst.y) {\n            if (dist + boxDst.x > depth) break;\n            // Simple sphere tracer.            \n            float sdfVal = sampleSdf(rayPos);\n            \n            if (sdfVal < 0.01) {\n                float curv;\n                vec3 normal;\n                calcNormalAndCurv(rayPos, normal, curv);\n                float ldn = dot(normal, vec3(1.0, 0.0, 0.0));\n                surfaceColor = mix(vec4(0.0, 0.0, 0.0, 1.0), vec4(colormap(abs(0.00001*curv)), 1.0), 0.5 + 0.5 * ldn);\n                break;\n            }\n\n            dist += sdfVal;\n            rayPos += sdfVal * rayDir;\n        }\n        depth = min(depth, boxDst.x + dist);\n    }\n\n    // Render volume.\n    vec4 proteinColor = vec4(0.0f);\n    if (displayProtein) {\n        bool inProximity = false;\n        vec3 rayPos = vOrigin + boxDst.x * rayDir;\n\n        float stepSize = 0.5;\n        float dist = 0.0;\n        while (dist < boxDst.y) {\n            float sdfVal = sampleSdf(rayPos) - isovalue;\n            \n            if (!inProximity) {\n                if (sdfVal < 0.01) {\n                    inProximity = true;\n                } else {\n                    dist += sdfVal;\n                    rayPos += sdfVal * rayDir;\n                }\n            } else {\n                if (sdfVal > 0.01) {\n                    inProximity = false;\n                    dist += sdfVal;\n                    rayPos += sdfVal * rayDir;\n                } else {\n                    float density = sampleProtein(rayPos);\n                    vec3 color = colormap(density);\n\n                    vec3 uvw = rayPos / volumeSize + 0.5;\n                    float distanceToMaximum = clamp(1.0 - abs(uvw.z - texture(projection, uvw.xy).g) / 0.025, 0.0, 1.0);\n                    float selectionMask = texture(selection, uvw.xy).r;\n\n                    float highlight = distanceToMaximum * selectionMask;\n                    color = mix(color, 3.0 * matlab_spring(density), highlight);\n\n                    proteinColor.rgb += density * (1.0 - proteinColor.a) * color;\n                    proteinColor.a += density * (1.0 - proteinColor.a);\n                    dist += stepSize;\n                    rayPos += stepSize * rayDir;\n                }\n            }\n            if (dist + boxDst.x > depth) break;\n        }\n    }\n\n    FragColor.rgb = mix(surfaceColor.rgb, proteinColor.rgb, proteinColor.a);\n    FragColor.a = max(surfaceColor.a, proteinColor.a);\n}"},177:function(e,t){e.exports="varying vec2 vUv;\n\nvoid main() {\n    vUv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}"},178:function(e,t){e.exports="\nvarying vec2 vUv;\n\nuniform sampler2D texGrid;\nuniform sampler2D texVolume;\n\nvoid main() {\n    gl_FragColor = vec4(mix(texture(texGrid, vUv).rgb, texture(texVolume, vUv).rgb, texture(texVolume, vUv).a), 1.0);\n}"},179:function(e,t){e.exports="varying vec2 vUv;\n\nvoid main() {\n    vUv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}"},180:function(e,t){e.exports="varying vec2 vUv;\n\nuniform highp sampler3D volume;\nuniform highp sampler3D sdf;\nuniform float isovalue;\n\nvoid main() {\n    vec3 uv = vec3(vUv, 0.0);\n    int col = textureSize(volume, 0).z;\n\n    // Maximum projection.\n    float maxDensity = 0.0;\n    float maxPos = 0.0;\n    for (float i = 0.0; i < float(col); i += 1.0) {\n        uv.z = i / float(col);\n        float sdfVal = texture(sdf, uv).r * 255.0 / 10.0 - 5.0 - isovalue;\n        if (sdfVal <= 0.01) {\n            float density = texture(volume, uv).r;\n            if (density > maxDensity) {\n                maxDensity = density;\n                maxPos = uv.z;\n            }\n        }\n    }\n\n    gl_FragColor = vec4(maxDensity, maxPos, 0.0, 1.0);\n}"},181:function(e,t){e.exports="varying vec2 vUv;\n\nvoid main() {\n    vUv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}"},182:function(e,t){e.exports="varying vec2 vUv;\n\nuniform bool clear;\nuniform vec2 lastPosition;\nuniform vec2 position;\nuniform bool depressed;\n\n// https://iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm\nfloat sdSegment( in vec2 p, in vec2 a, in vec2 b )\n{\n    vec2 pa = p-a, ba = b-a;\n    float h = clamp( dot(pa,ba)/dot(ba,ba), 0.0, 1.0 );\n    return length( pa - ba*h );\n}\n\nvoid main()\n{\n    if (clear) {\n        gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n        return;\n    }\n\n    if (sdSegment(vUv, position, lastPosition) < 0.015 && depressed) {\n        gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n    } else {\n        discard;\n    }\n}"},183:function(e,t){e.exports="varying vec2 vUv;\n\nvoid main() {\n    vUv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}"},184:function(e,t){e.exports="varying vec2 vUv;\n\nuniform highp sampler2D projection;\nuniform highp sampler2D selection;\n\n// https://github.com/kbinani/colormap-shaders/blob/master/shaders/glsl/MATLAB_summer.frag\nvec4 colormap(float x) {\n    return vec4(clamp(x, 0.0, 1.0), clamp(0.5 * x + 0.5, 0.0, 1.0), 0.4, 1.0);\n}\n\nvoid main() {\n    vec4 c1 = colormap(texture(projection, vUv).r);\n    vec4 c2 = texture(selection, vUv);\n\n    gl_FragColor = mix(0.5*c1, c1, c2.r);\n}"},290:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),o=n(32),i=n.n(o),s=(n(157),n(111),n(158),n(159),n(1)),l=n(3),c=n(14),d=n(4),p=n(5),h=n(138),m=n(33),u=n(108),f=n(141),v=n(2),b=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){var e;return e=this.props.fullscreen?"bi-fullscreen-exit":"bi-arrows-fullscreen",Object(v.jsxs)(f.a,{className:"justify-content-between",children:[Object(v.jsxs)(u.a,{children:[Object(v.jsx)(m.a,{onClick:this.props.onToggleSidebar,children:Object(v.jsx)("i",{className:"bi-tools"})}),Object(v.jsx)(m.a,{onClick:this.props.onImportData,children:"Import Data"})]}),Object(v.jsx)(u.a,{children:Object(v.jsx)(m.a,{onClick:this.props.onToggleFullscreen,children:Object(v.jsx)("i",{className:e})})})]})}}]),n}(r.Component),g=b,x=n(80),j=n(151),y=n(109),O=n(59),S=n(20),C=n(143),k=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).handleSelectCompartmet=r.handleSelectCompartmet.bind(Object(c.a)(r)),r.handleChangeDisplaySegmentation=r.handleChangeDisplaySegmentation.bind(Object(c.a)(r)),r.handleChangeDisplayProtein=r.handleChangeDisplayProtein.bind(Object(c.a)(r)),r}return Object(l.a)(n,[{key:"handleSelectCompartmet",value:function(e){this.props.onCompartmentSelection(e)}},{key:"handleChangeDisplaySegmentation",value:function(e){this.props.onDisplaySegmentation(e.target.checked)}},{key:"handleChangeDisplayProtein",value:function(e){this.props.onDisplayProtein(e.target.checked)}},{key:"render",value:function(){for(var e=this,t=[Object(v.jsx)(O.a.Item,{onClick:function(){return e.handleSelectCompartmet(0)},children:"All Compartments"})],n=function(){var n=r;t.push(Object(v.jsxs)(O.a.Item,{onClick:function(){return e.handleSelectCompartmet(n+1)},children:["Compartment ",n+1]}))},r=0;r<this.props.numCompartments-1;++r)n();var a="";return a=0===this.props.numCompartments?"No Compartment Data":0===this.props.selection?"All Compartments":"Compartment "+this.props.selection,Object(v.jsx)(C.a,{md:3,children:Object(v.jsx)(x.a,{children:Object(v.jsx)(j.a,{in:this.props.open,children:Object(v.jsx)(y.a,{children:Object(v.jsx)(y.a.Body,{children:Object(v.jsxs)(S.a,{children:[Object(v.jsxs)(S.a.Check,{className:"form-switch",children:[Object(v.jsx)(S.a.Check.Input,{checked:this.props.displayProtein,disabled:0===this.props.numCompartments,onChange:this.handleChangeDisplayProtein}),Object(v.jsx)(S.a.Check.Label,{children:"Display Protein"})]}),Object(v.jsxs)(S.a.Check,{className:"form-switch",children:[Object(v.jsx)(S.a.Check.Input,{checked:this.props.displaySegmentation,disabled:0===this.props.numCompartments,onChange:this.handleChangeDisplaySegmentation}),Object(v.jsx)(S.a.Check.Label,{children:"Display Segmentation"})]}),Object(v.jsx)(S.a.Range,{disabled:0===this.props.numCompartments}),Object(v.jsxs)(O.a,{children:[Object(v.jsx)(O.a.Toggle,{disabled:0===this.props.numCompartments,children:a}),Object(v.jsx)(O.a.Menu,{children:t})]})]})})})})})})}}]),n}(r.Component),P=function(e){return Object(v.jsx)("div",{className:"overlay d-grid gap-3",children:e.children})},w=n(15),D=n(6),z=(n(17),n(23),n(9)),I=n(144);n(145);z.m.DefaultUp=new z.z(0,0,1);var F=new I.a;F.showPanel(0),document.body.appendChild(F.dom);var E=null,N=null;var V=function(e){var t=Object(r.useRef)(null);return Object(r.useEffect)((function(){}),[e.mainView,e.mapView]),Object(r.useEffect)((function(){e.ready&&function(e,t){for(var n=[],r=0;r<e.length;++r){var a=new z.e(e[r],t[0],t[1],t[2]);a.format=z.t,a.minFilter=z.j,a.magFilter=z.j,a.unpackAlignment=1,n.push(a)}E.setDistanceData(n),N.setDistanceData(n)}(e.sdf.buffers,e.sdf.dims)}),[e.sdf,e.ready]),Object(r.useEffect)((function(){e.ready&&function(e,t){var n=new z.e(e,t[0],t[1],t[2]);n.format=z.t,n.minFilter=z.j,n.magFilter=z.j,n.unpackAlignment=1,E.setProteinData(n),N.setProteinData(n)}(e.protein.buffer,e.protein.dims)}),[e.protein,e.ready]),Object(r.useEffect)((function(){var t;e.ready&&(t=e.volumeSize,E.setVolumeSize(t[0],t[1],t[2]))}),[e.volumeSize,e.ready]),Object(r.useEffect)((function(){var t;e.ready&&(t=e.displayProtein,E.setDisplayProtein(t))}),[e.displayProtein,e.ready]),Object(r.useEffect)((function(){var t;e.ready&&(t=e.displaySegmentation,E.setDisplayCompartments(t))}),[e.displaySegmentation,e.ready]),Object(r.useEffect)((function(){var t;e.isovalue&&(t=e.isovalue,E.setIsovalue(t),N.setIsovalue(t))}),[e.isovalue,e.ready]),Object(r.useEffect)((function(){var t;e.ready&&(t=e.compartmentIndex,E.setCompartmentIndex(t),N.setCompartmentIndex(t))}),[e.compartmentIndex,e.ready]),Object(v.jsx)("canvas",Object(D.a)({className:"renderer",ref:t},e))},A=n(148),T=function(e){var t={labels:e.labelsHistogram,datasets:[{backgroundColor:"rgb(255, 99, 132)",borderColor:"rgb(255, 99, 132)",data:e.globalHistogram,label:"Global Histogram"},{backgroundColor:"rgb(0, 255, 132)",borderColor:"rgb(0, 255, 132)",data:e.localHistogram,label:"Local Histogram"}]};return Object(v.jsx)(v.Fragment,{children:Object(v.jsx)(A.a,{className:"plots",data:t,options:{scales:{yAxes:[{ticks:{beginAtZero:!0}}]},maintainAspectRatio:!1}})})},B=function(e){var t=Object(r.useRef)(null),n=Object(r.useRef)(null),a=Object(r.useState)(),o=Object(w.a)(a,2),i=o[0],s=o[1],l=Object(r.useState)(),c=Object(w.a)(l,2),d=c[0],p=c[1];Object(r.useEffect)((function(){s(t.current),p(n.current)}),[]);var h;return e.ready||(h=Object(v.jsx)("div",{className:"text-secondary h-100 d-flex justify-content-center align-items-center",children:Object(v.jsxs)(m.a,{variant:"primary",size:"lg",onClick:function(){e.onClickImport()},children:[Object(v.jsx)("i",{className:"bi-plus-square"}),"\xa0\xa0Import Data"]})})),Object(v.jsxs)(v.Fragment,{children:[Object(v.jsx)(V,{mainView:i,mapView:d,sdf:e.sdf,protein:e.protein,volumeSize:e.volumeSize,displayProtein:e.displayProtein,displaySegmentation:e.displaySegmentation,isovalue:e.isovalue,compartmentIndex:e.compartmentIndex,ready:e.ready}),Object(v.jsx)("div",{className:"views d-flex flex-col",children:Object(v.jsxs)("div",{className:"flex-fill d-flex flex-row",children:[Object(v.jsx)("div",{ref:t,className:"flex-fill",children:h}),Object(v.jsx)("div",{className:"v-divider"}),Object(v.jsxs)("div",{className:"flex-fill d-flex flex-column",children:[Object(v.jsx)("div",{ref:n,className:"flex-fill"}),Object(v.jsx)("div",{className:"h-divider"}),Object(v.jsx)("div",{className:"flex-fill",children:Object(v.jsx)(T,{localHistogram:e.localHistogram,globalHistogram:e.globalHistogram,labelsHistogram:e.labelsHistogram})})]})]})})]})},H=function(e){Object(d.a)(n,e);var t=Object(p.a)(n);function n(e){var r;return Object(s.a)(this,n),(r=t.call(this,e)).state={fullscreen:!1,showSidebar:!1,showImport:!1,voxelSize:[0,0,0],bufferDims:[0,0,0],sdfBuffers:[],proteinBuffer:"",ready:!1,compartmentIndex:0,displaySegmentation:!0,displayProtein:!0,globalHistogram:[],labelsHistogram:[],localHistogram:[]},r.handleShowImport=r.handleShowImport.bind(Object(c.a)(r)),r.handleToggleFullscreen=r.handleToggleFullscreen.bind(Object(c.a)(r)),r.handleToggleSidebar=r.handleToggleSidebar.bind(Object(c.a)(r)),r.handleAbortImport=r.handleAbortImport.bind(Object(c.a)(r)),r.handleCompleteImport=r.handleCompleteImport.bind(Object(c.a)(r)),r.handleCompartmentSelection=r.handleCompartmentSelection.bind(Object(c.a)(r)),r.handleDisplaySegmentation=r.handleDisplaySegmentation.bind(Object(c.a)(r)),r.handleDisplayProtein=r.handleDisplayProtein.bind(Object(c.a)(r)),r}return Object(l.a)(n,[{key:"handleShowImport",value:function(){this.setState({showImport:!0})}},{key:"handleAbortImport",value:function(){this.setState({showImport:!1})}},{key:"handleCompleteImport",value:function(e,t,n,r,a,o){this.setState({sdfBuffers:e,proteinBuffer:t,bufferDims:n,voxelSize:r,showImport:!1,ready:!0,globalHistogram:a,labelsHistogram:o})}},{key:"handleToggleFullscreen",value:function(){if(this.state.fullscreen)document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen();else{var e=document.documentElement;e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()}this.setState({fullscreen:!this.state.fullscreen})}},{key:"handleToggleSidebar",value:function(){this.setState({showSidebar:!this.state.showSidebar})}},{key:"handleCompartmentSelection",value:function(e){this.setState({compartmentIndex:e})}},{key:"handleDisplaySegmentation",value:function(e){this.setState({displaySegmentation:e})}},{key:"handleDisplayProtein",value:function(e){this.setState({displayProtein:e})}},{key:"render",value:function(){var e=[this.state.bufferDims[0]*this.state.voxelSize[0],this.state.bufferDims[1]*this.state.voxelSize[1],this.state.bufferDims[2]*this.state.voxelSize[2]];return Object(v.jsxs)(v.Fragment,{children:[Object(v.jsx)(h.a,{show:this.state.showImport,onAbort:this.handleAbortImport,onComplete:this.handleCompleteImport}),Object(v.jsxs)(P,{children:[Object(v.jsx)(g,{fullscreen:this.state.fullscreen,onImportData:this.handleShowImport,onToggleFullscreen:this.handleToggleFullscreen,onToggleSidebar:this.handleToggleSidebar}),Object(v.jsx)(k,{open:this.state.showSidebar,numCompartments:this.state.sdfBuffers.length,onCompartmentSelection:this.handleCompartmentSelection,selection:this.state.compartmentIndex,onDisplaySegmentation:this.handleDisplaySegmentation,onDisplayProtein:this.handleDisplayProtein,displayProtein:this.state.displayProtein,displaySegmentation:this.state.displaySegmentation})]}),Object(v.jsx)(B,{sdf:{buffers:this.state.sdfBuffers,dims:this.state.bufferDims},protein:{buffer:this.state.proteinBuffer,dims:this.state.bufferDims},volumeSize:e,displayProtein:this.state.displayProtein,displaySegmentation:this.state.displaySegmentation,isovalue:0,compartmentIndex:this.state.compartmentIndex,ready:this.state.ready,onClickImport:this.handleShowImport,localHistogram:this.state.localHistogram,globalHistogram:this.state.globalHistogram,labelsHistogram:this.state.labelsHistogram})]})}}]),n}(r.Component);var U=function(){return Object(v.jsx)("div",{className:"App",children:Object(v.jsx)(H,{})})},M=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,296)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,o=t.getLCP,i=t.getTTFB;n(e),r(e),a(e),o(e),i(e)}))};i.a.render(Object(v.jsx)(a.a.StrictMode,{children:Object(v.jsx)(U,{})}),document.getElementById("root")),M()}},[[290,1,2]]]);
//# sourceMappingURL=main.436e22b8.chunk.js.map