(this["webpackJsonppan-vision-viewer"]=this["webpackJsonppan-vision-viewer"]||[]).push([[0],{100:function(e,t,n){e.exports=n.p+"static/js/sdf-worker.d19c0e83.chunk.worker.js"},105:function(e,t,n){e.exports=n.p+"static/js/tiff-worker.86009c6a.chunk.worker.js"},116:function(e,t,n){"use strict";n.r(t);var r=n(0),s=n.n(r),a=n(25),o=n.n(a),i=(n(97),n(76),n(98),n(99),n(10)),l=n(11),c=n(7),h=n(14),p=n(15),d=n(83),u=n(34),b=n(73),m=n(86),g=n(1),j=function(e){Object(h.a)(n,e);var t=Object(p.a)(n);function n(){return Object(i.a)(this,n),t.apply(this,arguments)}return Object(l.a)(n,[{key:"render",value:function(){var e;return e=this.props.fullscreen?"bi-fullscreen-exit":"bi-arrows-fullscreen",Object(g.jsxs)(m.a,{className:"justify-content-between",children:[Object(g.jsxs)(b.a,{children:[Object(g.jsx)(u.a,{onClick:this.props.onToggleSidebar,children:Object(g.jsx)("i",{className:"bi-tools"})}),Object(g.jsx)(u.a,{onClick:this.props.onImportData,children:"Import Data"})]}),Object(g.jsx)(b.a,{children:Object(g.jsx)(u.a,{onClick:this.props.onToggleFullscreen,children:Object(g.jsx)("i",{className:e})})})]})}}]),n}(r.Component),f=j,O=n(60),x=n(91),v=n(74),C=n(49),y=n(12),S=n(88),k=function(e){Object(h.a)(n,e);var t=Object(p.a)(n);function n(e){var r;return Object(i.a)(this,n),(r=t.call(this,e)).handleSelectCompartmet=r.handleSelectCompartmet.bind(Object(c.a)(r)),r.handleChangeDisplaySegmentation=r.handleChangeDisplaySegmentation.bind(Object(c.a)(r)),r.handleChangeDisplayProtein=r.handleChangeDisplayProtein.bind(Object(c.a)(r)),r}return Object(l.a)(n,[{key:"handleSelectCompartmet",value:function(e){this.props.onCompartmentSelection(e)}},{key:"handleChangeDisplaySegmentation",value:function(e){this.props.onDisplaySegmentation(e.target.checked)}},{key:"handleChangeDisplayProtein",value:function(e){this.props.onDisplayProtein(e.target.checked)}},{key:"render",value:function(){for(var e=this,t=[Object(g.jsx)(C.a.Item,{onClick:function(){return e.handleSelectCompartmet(0)},children:"All Compartments"})],n=function(){var n=r;t.push(Object(g.jsxs)(C.a.Item,{onClick:function(){return e.handleSelectCompartmet(n+1)},children:["Compartment ",n+1]}))},r=0;r<this.props.numCompartments-1;++r)n();var s="";return s=0===this.props.numCompartments?"No Compartment Data":0===this.props.selection?"All Compartments":"Compartment "+this.props.selection,Object(g.jsx)(S.a,{md:3,children:Object(g.jsx)(O.a,{children:Object(g.jsx)(x.a,{in:this.props.open,children:Object(g.jsx)(v.a,{children:Object(g.jsx)(v.a.Body,{children:Object(g.jsxs)(y.a,{children:[Object(g.jsxs)(y.a.Check,{className:"form-switch",children:[Object(g.jsx)(y.a.Check.Input,{checked:this.props.displayProtein,disabled:0===this.props.numCompartments,onChange:this.handleChangeDisplayProtein}),Object(g.jsx)(y.a.Check.Label,{children:"Display Protein"})]}),Object(g.jsxs)(y.a.Check,{className:"form-switch",children:[Object(g.jsx)(y.a.Check.Input,{checked:this.props.displaySegmentation,disabled:0===this.props.numCompartments,onChange:this.handleChangeDisplaySegmentation}),Object(g.jsx)(y.a.Check.Label,{children:"Display Segmentation"})]}),Object(g.jsx)(y.a.Range,{disabled:0===this.props.numCompartments}),Object(g.jsxs)(C.a,{children:[Object(g.jsx)(C.a.Toggle,{disabled:0===this.props.numCompartments,children:s}),Object(g.jsx)(C.a.Menu,{children:t})]})]})})})})})})}}]),n}(r.Component),w=function(e){return Object(g.jsx)("div",{className:"overlay d-grid gap-3",children:e.children})},P=function(e){Object(h.a)(n,e);var t=Object(p.a)(n);function n(e){var r;return Object(i.a)(this,n),(r=t.call(this,e)).state={fullscreen:!1,showSidebar:!1,showImport:!1,voxelSize:[0,0,0],bufferDims:[0,0,0],sdfBuffers:[],proteinBuffer:"",ready:!1,compartmentIndex:0,displaySegmentation:!0,displayProtein:!0,globalHistogram:[],labelsHistogram:[],localHistogram:[]},r.handleShowImport=r.handleShowImport.bind(Object(c.a)(r)),r.handleToggleFullscreen=r.handleToggleFullscreen.bind(Object(c.a)(r)),r.handleToggleSidebar=r.handleToggleSidebar.bind(Object(c.a)(r)),r.handleAbortImport=r.handleAbortImport.bind(Object(c.a)(r)),r.handleCompleteImport=r.handleCompleteImport.bind(Object(c.a)(r)),r.handleCompartmentSelection=r.handleCompartmentSelection.bind(Object(c.a)(r)),r.handleDisplaySegmentation=r.handleDisplaySegmentation.bind(Object(c.a)(r)),r.handleDisplayProtein=r.handleDisplayProtein.bind(Object(c.a)(r)),r}return Object(l.a)(n,[{key:"handleShowImport",value:function(){this.setState({showImport:!0})}},{key:"handleAbortImport",value:function(){this.setState({showImport:!1})}},{key:"handleCompleteImport",value:function(e,t,n,r,s,a){this.setState({sdfBuffers:e,proteinBuffer:t,bufferDims:n,voxelSize:r,showImport:!1,ready:!0,globalHistogram:s,labelsHistogram:a})}},{key:"handleToggleFullscreen",value:function(){if(this.state.fullscreen)document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen();else{var e=document.documentElement;e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()}this.setState({fullscreen:!this.state.fullscreen})}},{key:"handleToggleSidebar",value:function(){this.setState({showSidebar:!this.state.showSidebar})}},{key:"handleCompartmentSelection",value:function(e){this.setState({compartmentIndex:e})}},{key:"handleDisplaySegmentation",value:function(e){this.setState({displaySegmentation:e})}},{key:"handleDisplayProtein",value:function(e){this.setState({displayProtein:e})}},{key:"render",value:function(){return Object(g.jsxs)(g.Fragment,{children:[Object(g.jsx)(d.a,{show:this.state.showImport,onAbort:this.handleAbortImport,onComplete:this.handleCompleteImport}),Object(g.jsxs)(w,{children:[Object(g.jsx)(f,{fullscreen:this.state.fullscreen,onImportData:this.handleShowImport,onToggleFullscreen:this.handleToggleFullscreen,onToggleSidebar:this.handleToggleSidebar}),Object(g.jsx)(k,{open:this.state.showSidebar,numCompartments:this.state.sdfBuffers.length,onCompartmentSelection:this.handleCompartmentSelection,selection:this.state.compartmentIndex,onDisplaySegmentation:this.handleDisplaySegmentation,onDisplayProtein:this.handleDisplayProtein,displayProtein:this.state.displayProtein,displaySegmentation:this.state.displaySegmentation})]})]})}}]),n}(r.Component);var I=function(){return Object(g.jsx)("div",{className:"App",children:Object(g.jsx)(P,{})})},F=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,122)).then((function(t){var n=t.getCLS,r=t.getFID,s=t.getFCP,a=t.getLCP,o=t.getTTFB;n(e),r(e),s(e),a(e),o(e)}))};o.a.render(Object(g.jsx)(s.a.StrictMode,{children:Object(g.jsx)(I,{})}),document.getElementById("root")),F()},72:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return h}));var r=n(19),s=n.n(r),a=n(35),o=n(10),i=n(11),l=n(85),c=n(37),h=function(){function t(){Object(o.a)(this,t),this.buffer=null,this.pixels=new Uint8Array,this.width=0,this.height=0,this.depth=0,this.bits=0}return Object(i.a)(t,[{key:"open",value:function(){var e=Object(a.a)(s.a.mark((function e(t){var n,r,a,o,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e,n){var r=new FileReader;r.readAsArrayBuffer(t),r.onload=function(t){e(t.target.result)},r.onerror=function(e){n(r.error)},r.onabort=function(e){n("FileReader was aborted!")}}));case 2:if(n=e.sent,r=l.decode(n),0!==Object.keys(r[0]).length){e.next=6;break}throw new Error("Could not decode TIFF file!");case 6:if(c=r[0],1===(a={t256:c.t256,t257:c.t257,t258:c.t258,t277:c.t277}).t277){e.next=9;break}throw new Error("Only grayscale images are supported.");case 9:if(8===a.t258){e.next=11;break}throw new Error("Only images with bit depth 8 are supported.");case 11:o=0;case 12:if(!(o<r.length)){e.next=19;break}if(s=r[o],i={t256:s.t256,t257:s.t257,t258:s.t258,t277:s.t277},JSON.stringify(a)===JSON.stringify(i)){e.next=16;break}throw new Error("Slice "+o+" has incorrect dimensions or pixel depth.");case 16:++o,e.next=12;break;case 19:this.buffer=n,this.width=a.t256[0],this.height=a.t257[0],this.depth=r.length,this.bits=a.t258[0];case 24:case"end":return e.stop()}var s,c}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"decode",value:function(){var t=Object(a.a)(s.a.mark((function t(n,r){var a;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=c.b(new Worker(e,{name:"tiff-worker",type:void 0})),t.next=3,a(this.buffer,c.a(n),c.a(r));case 3:this.pixels=t.sent;case 4:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()}]),t}()}).call(this,n(105))},76:function(e,t,n){},83:function(e,t,n){"use strict";(function(e){var r=n(19),s=n.n(r),a=n(35),o=n(10),i=n(11),l=n(7),c=n(14),h=n(15),p=n(0),d=n(89),u=n(90),b=n(37),m=n(72),g=n(1),j=function(t){Object(c.a)(r,t);var n=Object(h.a)(r);function r(e){var t;return Object(o.a)(this,r),(t=n.call(this,e)).state={tiffProtein:"",tiffSegmentation:"",voxelSize:"",proteinProgress:0,segmentationProgress:0,sdfProgress:0,proteinError:"",segmentationError:"",sdfError:"",step:"dialog",preImportError:""},t.handleImport=t.handleImport.bind(Object(l.a)(t)),t.handleClose=t.handleClose.bind(Object(l.a)(t)),t.onProteinProgress=t.onProteinProgress.bind(Object(l.a)(t)),t.onSegmentationProgress=t.onSegmentationProgress.bind(Object(l.a)(t)),t.onProteinError=t.onProteinError.bind(Object(l.a)(t)),t.onSegmentationError=t.onSegmentationError.bind(Object(l.a)(t)),t.onSdfProgress=t.onSdfProgress.bind(Object(l.a)(t)),t.onSdfError=t.onSdfError.bind(Object(l.a)(t)),t}return Object(i.a)(r,[{key:"onProteinProgress",value:function(e){this.setState({proteinProgress:e})}},{key:"onSegmentationProgress",value:function(e){this.setState({segmentationProgress:e})}},{key:"onProteinError",value:function(e){this.setState({proteinError:e})}},{key:"onSegmentationError",value:function(e){this.setState({segmentationError:e})}},{key:"onSdfProgress",value:function(e){this.setState({sdfProgress:e})}},{key:"onSdfError",value:function(e){this.setState({sdfError:e})}},{key:"handleImport",value:function(){var t=Object(a.a)(s.a.mark((function t(n,r,a){var o,i,l,c,h,p,d,u,g,j,f,O,x,v,C,y=this;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o=new m.a,i=new m.a,t.prev=2,t.next=5,o.open(n);case 5:return t.next=7,i.open(r);case 7:t.next=13;break;case 9:return t.prev=9,t.t0=t.catch(2),this.setState({preImportError:t.t0}),t.abrupt("return");case 13:if(o.width===i.width&&o.height===i.height&&o.depth===i.depth){t.next=16;break}return this.setState({preImportError:"Please make sure the protein and the segmentation data have the same dimensions."}),t.abrupt("return");case 16:return this.setState({step:"import",voxelSize:a,tiffProtein:o,tiffSegmentation:i,segmentationProgress:0,proteinProgress:0,sdfProgress:0,segmentationError:"",proteinError:"",sdfError:""}),t.next=19,o.decode(this.onProteinError,this.onProteinProgress);case 19:return t.next=21,i.decode(this.onSegmentationError,this.onSegmentationProgress);case 21:for(l=function(e,t){return Math.max(e,t)},c=i.pixels.reduce(l),h=[],p=new Array(c+1),d=function(){var t=u,n=function(e){p[t]=100*e,y.onSdfProgress(p.reduce((function(e,t){return e+t}),0)/(c+1))};h.push(new Promise((function(r,s){var o=new Worker(e,{name:"sdf-worker",type:void 0});r(b.b(o)(i,a,t,b.a(n)))})))},u=0;u<c+1;++u)d();return t.next=29,Promise.all(h);case 29:for(g=t.sent,this.onSdfProgress(100),8,j=new Float32Array(Math.pow(2,8)),f=new Float32Array(Math.pow(2,8)),O=0;O<g[0].length;++O)j[g[0][O]]+=o.pixels[O],f[g[0][O]]+=1;for(x=0;x<j.length;++x)j[x]=j[x]/f[x];for(v=[],C=0;C<256;++C)v.push(C/10-5);this.setState({step:"dialog"}),this.props.onComplete(g,o.pixels,[o.width,o.height,o.depth],[parseFloat(a.x),parseFloat(a.y),parseFloat(a.z)],j,v);case 40:case"end":return t.stop()}}),t,this,[[2,9]])})));return function(e,n,r){return t.apply(this,arguments)}}()},{key:"handleClose",value:function(){this.props.onAbort()}},{key:"render",value:function(){return Object(g.jsxs)(g.Fragment,{children:[Object(g.jsx)(d.a,{show:"dialog"===this.state.step&&this.props.show,error:this.state.preImportError,onImport:this.handleImport,onClose:this.handleClose}),Object(g.jsx)(u.a,{show:"import"===this.state.step&&this.props.show,proteinProgress:this.state.proteinProgress,segmentationProgress:this.state.segmentationProgress,sdfProgress:this.state.sdfProgress,proteinError:this.state.proteinError,segmentationError:this.state.segmentationError,sdfError:this.state.sdfError})]})}}]),r}(p.Component);t.a=j}).call(this,n(100))},89:function(e,t,n){"use strict";var r=n(19),s=n.n(r),a=n(35),o=n(10),i=n(11),l=n(7),c=n(14),h=n(15),p=n(0),d=n(61),u=n(34),b=n(21),m=n(12),g=n(71),j=n(1),f=function(e){Object(c.a)(n,e);var t=Object(h.a)(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).handleChangeX=r.handleChangeX.bind(Object(l.a)(r)),r.handleChangeY=r.handleChangeY.bind(Object(l.a)(r)),r.handleChangeZ=r.handleChangeZ.bind(Object(l.a)(r)),r}return Object(i.a)(n,[{key:"handleChangeX",value:function(e){this.props.onChange({x:e.target.value,y:this.props.value.y,z:this.props.value.z})}},{key:"handleChangeY",value:function(e){this.props.onChange({x:this.props.value.x,y:e.target.value,z:this.props.value.z})}},{key:"handleChangeZ",value:function(e){this.props.onChange({x:this.props.value.x,y:this.props.value.y,z:e.target.value})}},{key:"render",value:function(){return Object(j.jsxs)(g.a,{className:"mb-3",children:[Object(j.jsx)(g.a.Text,{children:"Voxel Size"}),Object(j.jsx)(m.a.Control,{type:"number",placeholder:"x",value:this.props.value.x,onChange:this.handleChangeX}),Object(j.jsx)(m.a.Control,{type:"number",placeholder:"y",value:this.props.value.y,onChange:this.handleChangeY}),Object(j.jsx)(m.a.Control,{type:"number",placeholder:"z",value:this.props.value.z,onChange:this.handleChangeZ})]})}}]),n}(p.Component),O=function(e){Object(c.a)(n,e);var t=Object(h.a)(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={fileProtein:"",fileSegmentation:"",voxelSize:{x:"",y:"",z:""},working:!1},r.handleClickImport=r.handleClickImport.bind(Object(l.a)(r)),r.handleChangeFileProtein=r.handleChangeFileProtein.bind(Object(l.a)(r)),r.handleChangeFileSegmentation=r.handleChangeFileSegmentation.bind(Object(l.a)(r)),r.handleChangeVoxelSize=r.handleChangeVoxelSize.bind(Object(l.a)(r)),r.handleClose=r.handleClose.bind(Object(l.a)(r)),r}return Object(i.a)(n,[{key:"handleChangeFileProtein",value:function(e){this.setState({fileProtein:e.target.files[0]})}},{key:"handleChangeFileSegmentation",value:function(e){this.setState({fileSegmentation:e.target.files[0]})}},{key:"handleChangeVoxelSize",value:function(e){this.setState({voxelSize:e})}},{key:"handleClickImport",value:function(){var e=Object(a.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setState({working:!0}),this.props.onImport(this.state.fileProtein,this.state.fileSegmentation,this.state.voxelSize),this.setState({working:!1});case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleClose",value:function(e){this.props.onClose()}},{key:"render",value:function(){var e,t;return e=!(!(this.state.fileProtein&&this.state.fileSegmentation&&this.state.voxelSize.x&&this.state.voxelSize.y&&this.state.voxelSize.z)||this.state.working),this.props.error&&(t=Object(j.jsx)(d.a,{variant:"danger",children:this.props.error})),Object(j.jsxs)(b.a,{show:this.props.show,onHide:this.handleClose,children:[Object(j.jsx)(b.a.Header,{closeButton:!0,children:Object(j.jsx)(b.a.Title,{children:"Import Data"})}),Object(j.jsxs)(b.a.Body,{children:[Object(j.jsxs)(m.a,{children:[Object(j.jsxs)(m.a.Group,{className:"mb-3",children:[Object(j.jsx)(m.a.Label,{children:"Protein Data"}),Object(j.jsx)(m.a.Control,{type:"file",onChange:this.handleChangeFileProtein})]}),Object(j.jsxs)(m.a.Group,{className:"mb-3",children:[Object(j.jsx)(m.a.Label,{children:"Segmentation Data"}),Object(j.jsx)(m.a.Control,{type:"file",onChange:this.handleChangeFileSegmentation})]}),Object(j.jsx)(f,{value:this.state.voxelSize,onChange:this.handleChangeVoxelSize})]}),t]}),Object(j.jsx)(b.a.Footer,{children:Object(j.jsx)(u.a,{variant:"primary",disabled:!e,onClick:this.handleClickImport,children:"Import"})})]})}}]),n}(p.Component);t.a=O},90:function(e,t,n){"use strict";var r=n(10),s=n(11),a=n(14),o=n(15),i=n(0),l=n(21),c=(n(76),n(61)),h=n(75),p=n(1),d=function(e){Object(a.a)(n,e);var t=Object(o.a)(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"render",value:function(){var e="";this.props.progress>=100&&(e="success"),this.props.error&&(e="danger");var t,n=this.props.progress<100&&!this.props.error;return this.props.error&&(t=Object(p.jsx)(c.a,{variant:"danger",children:this.props.error})),Object(p.jsxs)("div",{className:"labeled-progress-bar",children:[Object(p.jsxs)(h.a,{children:[Object(p.jsx)("div",{className:"label-front",style:{clipPath:"inset(0 ".concat(100-this.props.progress,"% 0 0)")},children:this.props.label}),Object(p.jsx)("div",{className:"label-back",children:this.props.label}),Object(p.jsx)(h.a,{striped:!0,variant:e,animated:n,now:this.props.progress})]}),t]})}}]),n}(i.Component),u=d,b=function(e){Object(a.a)(n,e);var t=Object(o.a)(n);function n(e){var s;return Object(r.a)(this,n),(s=t.call(this,e)).state={proteinProgress:0,segmentationProgress:0,sdfProgress:0,proteinError:"",segmentationError:"",sdfError:""},s}return Object(s.a)(n,[{key:"componentDidMount",value:function(){}},{key:"componentWillUnmount",value:function(){}},{key:"render",value:function(){return Object(p.jsxs)(l.a,{backdrop:"static",show:this.props.show,children:[Object(p.jsx)(l.a.Header,{children:Object(p.jsx)(l.a.Title,{children:"Importing Data..."})}),Object(p.jsx)(l.a.Body,{children:Object(p.jsxs)("div",{className:"d-grid gap-3",children:[Object(p.jsx)(u,{progress:this.props.proteinProgress,error:this.props.proteinError,label:"Decode Protein TIFF..."}),Object(p.jsx)(u,{progress:this.props.segmentationProgress,error:this.props.segmentationError,label:"Decode Segmentation TIFF..."}),Object(p.jsx)(u,{progress:this.props.sdfProgress,error:this.props.sdfError,label:"Compute Distance Fields..."})]})})]})}}]),n}(i.Component);t.a=b},97:function(e,t,n){}},[[116,1,2]]]);
//# sourceMappingURL=main.0c2d32ba.chunk.js.map