(this["webpackJsonppan-vision-viewer"]=this["webpackJsonppan-vision-viewer"]||[]).push([[0],{102:function(e,t,n){"use strict";var r=n(1);t.a=function(e){return Object(r.jsx)("div",{className:"overlay fill-screen d-grid gap-3",children:e.children})}},105:function(e,t,n){"use strict";var r=n(0),a=n(20),i=n(1);t.a=function(e){var t=Object(r.useRef)(null);return Object(r.useEffect)((function(){a.l(e.onProjectionUpdated)}),[e.onProjectionUpdated]),Object(r.useEffect)((function(){a.m(e.onSelectionDone)}),[e.onSelectionDone]),Object(r.useEffect)((function(){e.ready&&e.mainView&&e.mapView&&a.c(t.current,e.mainView,e.mapView)}),[e.mainView,e.mapView,e.ready]),Object(r.useEffect)((function(){e.ready&&e.mainView&&e.mapView&&a.i(e.sdf,e.volumeDims)}),[e.sdf,e.mainView,e.mapView,e.ready,e.volumeDims]),Object(r.useEffect)((function(){e.ready&&e.mainView&&e.mapView&&a.p(e.protein,e.volumeDims)}),[e.protein,e.mainView,e.mapView,e.ready,e.volumeDims]),Object(r.useEffect)((function(){e.ready&&e.mainView&&e.mapView&&a.e(e.curvature,e.volumeDims)}),[e.curvature,e.mainView,e.mapView,e.ready,e.volumeDims]),Object(r.useEffect)((function(){e.ready&&e.mainView&&e.mapView&&a.r(e.volumeSize)}),[e.volumeSize,e.mainView,e.mapView,e.ready]),Object(r.useEffect)((function(){e.ready&&e.mainView&&e.mapView&&a.h(e.displayProtein)}),[e.displayProtein,e.mainView,e.mapView,e.ready]),Object(r.useEffect)((function(){e.ready&&e.mainView&&e.mapView&&a.g(e.displaySegmentation)}),[e.displaySegmentation,e.mainView,e.mapView,e.ready]),Object(r.useEffect)((function(){e.ready&&e.mainView&&e.mapView&&a.d(e.compartmentIndex)}),[e.compartmentIndex,e.mainView,e.mapView,e.ready]),Object(r.useEffect)((function(){e.ready&&e.mainView&&e.mapView&&a.f(e.debugSamples)}),[e.debugSamples,e.mainView,e.mapView,e.ready]),Object(r.useEffect)((function(){e.ready&&e.mainView&&e.mapView&&a.q(e.useLod)}),[e.useLod,e.mainView,e.mapView,e.ready]),Object(r.useEffect)((function(){e.ready&&e.mainView&&e.mapView&&a.j(e.isovalue)}),[e.isovalue,e.mainView,e.mapView,e.ready]),Object(i.jsx)("canvas",{className:"renderer",ref:t})}},106:function(e,t,n){"use strict";var r=n(0),a=n(14),i=n(103),o=n.n(i),s=n(26),l=n(1),c=function(e){var t=Object(r.useState)("heatmap"),n=Object(a.a)(t,2),i=n[0],c=n[1],u={},m={},h="";if("heatmap"===i){h="Heatmap";for(var d=Array.from(Array(e.heatmap.length).fill(0),(function(){return new Array(e.heatmap.length).fill(0)})),f=new Array(e.heatmap.length),p=new Array(e.heatmap[0].length),v=0;v<d.length;++v){f[v]=v/255*(e.heataxes[0][1]-e.heataxes[0][0])+e.heataxes[0][0],p[v]=v/255*(e.heataxes[1][1]-e.heataxes[1][0])+e.heataxes[1][0];for(var x=0;x<d.length;++x)0===e.heatarea[v][x]?d[v][x]=0:d[v][x]=e.heatmap[v][x]/e.heatarea[v][x]}for(var b=Array.from(Array(e.localHeatmap.length).fill(0),(function(){return new Array(e.localHeatmap.length).fill(0)})),g=0,j=0;j<b.length;++j)for(var y=0;y<b.length;++y)g+=e.localHeatarea[j][y],0===e.localHeatarea[j][y]?b[j][y]=0:b[j][y]=e.localHeatmap[j][y]/e.localHeatarea[j][y];u=[{x:f,y:p,z:d,type:"heatmap",colorscale:"Hot",colorbar:{title:"Protein count/voxel",titleside:"right"}},g>0?{x:f,y:p,z:b,type:"heatmap",colorscale:[[0,"#26828e00"],[1e-4,"#26828eff"],[.2,"#1f9e89ff"],[.4,"#35b779ff"],[.6,"#6ece58ff"],[.8,"#b5de2bff"],[1,"#fde725ff"]],colorbar:{title:"Local Protein count/voxel",titleside:"right",x:"1.2"}}:{}],m={title:"Protein Heatmap",xaxis:{title:{text:"Distance"}},yaxis:{title:{text:"Mean Curvature"}}}}else if("distance"===i){h="Distance Histogram";for(var w=new Array(256),S=0;S<256;++S){for(var O=0,k=0,C=0;C<256;++C)k+=e.heatmap[C][S],O+=e.heatarea[C][S];w[S]=k/O}var P=new Array(256);if(0!==e.localHeatmap.length)for(var D=0;D<256;++D){for(var E=0,z=0,V=0;V<256;++V)z+=e.localHeatmap[V][D],E+=e.localHeatarea[V][D];P[D]=z/E}for(var T=new Array(e.heatmap.length),M=0;M<e.heatmap.length;++M)T[M]=M/255*(e.heataxes[0][1]-e.heataxes[0][0])+e.heataxes[0][0];u=[{x:T,y:w,type:"bar",name:"Global"},{x:T,y:P,type:"bar",name:"Selection"}],m={title:"Distance Histogram",xaxis:{title:{text:"Distance"}},yaxis:{title:{text:"Protein count/voxel"}}}}else if("curvature"===i){h="Curvature Histogram";for(var I=new Array(256),F=0;F<256;++F){for(var R=0,A=0,U=0;U<256;++U)A+=e.heatmap[F][U],R+=e.heatarea[F][U];I[F]=A/R}var H=new Array(256);if(0!==e.localHeatmap.length)for(var L=0;L<256;++L){for(var N=0,B=0,_=0;_<256;++_)B+=e.localHeatmap[L][_],N+=e.localHeatarea[L][_];H[L]=B/N}for(var G=new Array(e.heatmap.length),W=0;W<e.heatmap.length;++W)G[W]=W/255*(e.heataxes[1][1]-e.heataxes[1][0])+e.heataxes[1][0];u=[{x:G,y:I,type:"bar",name:"Global"},{x:G,y:H,type:"bar",name:"Selection"}],m={title:"Mean Curvature Histogram",xaxis:{title:{text:"Mean Curvature"}},yaxis:{title:{text:"Protein count/voxel"}}}}else if("compartments"===i){h="Compartments";for(var q=Array(e.compartmentHistogram.length),X=0;X<q.length;++X)q[X]="Compartment "+(X+1);u=[{x:q,y:e.compartmentHistogram,type:"bar",name:"Global"}],m={title:"Protein Density per Compartment",xaxis:{title:{text:"Compartment"}},yaxis:{title:{text:"Protein count/voxel"}}}}return Object(l.jsxs)(l.Fragment,{children:[Object(l.jsx)(o.a,{data:u,layout:m,config:{responsive:!0}}),Object(l.jsx)("div",{className:"stack overlay",children:Object(l.jsxs)(s.a,{className:"pointer-events",children:[Object(l.jsx)(s.a.Toggle,{children:h}),Object(l.jsxs)(s.a.Menu,{children:[Object(l.jsx)(s.a.Item,{onClick:function(){c("heatmap")},children:"Distance/Curvature Heatmap"}),Object(l.jsx)(s.a.Item,{onClick:function(){c("distance")},children:"Distance Histogram"}),Object(l.jsx)(s.a.Item,{onClick:function(){c("curvature")},children:"Curvature Histogram"}),Object(l.jsx)(s.a.Item,{onClick:function(){c("compartments")},children:"Compartments"})]})]})})]})},u=n(19),m=n(42),h=n(74),d=n(57),f=n(67),p=function(e){var t=Object(r.useRef)(),n=Object(r.useState)(!1),i=Object(a.a)(n,2),o=i[0],s=i[1],c=Object(r.useState)(""),m=Object(a.a)(c,2),h=m[0],p=m[1],v=Object(r.useState)(!1),x=Object(a.a)(v,2),b=x[0],g=x[1];Object(r.useEffect)((function(){t.current&&o&&(t.current.focus(),t.current.value=h)}),[o,h,t]);var j,y=function(t){s(t),p(e.label)};return j=!0===o?Object(l.jsx)(f.a,{style:{marginLeft:"auto"},onKeyPress:function(e){"Enter"===e.key&&y(!1)},onChange:function(t){e.onLabel(t.target.value)},onBlur:function(){b||y(!1)},ref:t}):Object(l.jsx)(u.a,{style:{marginLeft:"auto"},onClick:e.onClick,children:e.label}),Object(l.jsxs)(d.a,{className:"pointer-events",children:[j,Object(l.jsx)(u.a,{onClick:function(){y(!o)},onMouseEnter:function(){return g(!0)},onMouseLeave:function(){return g(!1)},children:Object(l.jsx)("i",{className:"bi-tag-fill"})}),Object(l.jsx)(u.a,{onClick:e.onExport,children:Object(l.jsx)("i",{className:"bi-download"})}),Object(l.jsx)(u.a,{onClick:e.onDelete,children:Object(l.jsx)("i",{className:"bi-trash-fill"})})]})},v=n(20),x=n(104),b=n.n(x),g=n(80),j=n(155),y=b.a.createInstance({name:"selectionStore",storeName:"storeData",description:"..."}),w=function(e){var t=Object(r.useState)(20),n=Object(a.a)(t,2),i=n[0],o=n[1],s=Object(r.useState)("draw"),c=Object(a.a)(s,2),d=c[0],f=c[1],x=Object(r.useState)([]),b=Object(a.a)(x,2),w=b[0],S=b[1];Object(r.useEffect)((function(){C()}),[]);for(var O=function(e){f(e),v.n(e)},k=function(e){o(e),v.o(e)},C=function(){var e={};y.iterate((function(t,n,r){e[n]=t.name})).then((function(){S(e)}))},P=[],D=function(){var e=Object(a.a)(z[E],2),t=e[0],n=e[1];P.push(Object(l.jsx)(p,{label:n,onClick:function(){return e=t,void y.getItem(e).then((function(e){v.k(e.data,e.width,e.height)}));var e},onDelete:function(){return e=t,void y.removeItem(e).then(C);var e},onLabel:function(e){return function(e,t){y.getItem(e).then((function(n){n.name=t,y.setItem(e,n).then(C)}))}(t,e)},onExport:function(){return e=t,void y.getItem(e).then((function(e){var t=g.encode([e.data.buffer],e.width,e.height,0),n=new Blob([t],{type:"image/png"}),r=URL.createObjectURL(n),a=document.createElement("a");a.href=r,a.download=e.name,a.click()}));var e}}))},E=0,z=Object.entries(w);E<z.length;E++)D();return Object(l.jsxs)("div",{className:"stack no-pointer-events",style:{position:"relative"},children:[Object(l.jsx)("div",{className:"overlay d-flex flex-column-reverse",style:{overflowY:"overlay",height:"80%",right:0,bottom:0},children:Object(l.jsx)("div",{className:"align-self-end d-grid gap-2",children:P})}),Object(l.jsx)("div",{className:"overlay",children:Object(l.jsxs)(h.a,{style:{flexDirection:"column",width:"20pt"},children:[Object(l.jsx)(m.a,{vertical:!0,children:Object(l.jsx)(u.a,{onClick:function(){v.a()},children:Object(l.jsx)("i",{className:"bi-trash-fill"})})}),Object(l.jsx)("br",{}),Object(l.jsxs)(m.a,{vertical:!0,children:[Object(l.jsx)(u.a,{disabled:"draw"===d,onClick:function(){O("draw")},children:Object(l.jsx)("i",{className:"bi-pencil-fill"})}),Object(l.jsx)(u.a,{disabled:"erase"===d,onClick:function(){O("erase")},children:Object(l.jsx)("i",{className:"bi-eraser-fill"})})]}),Object(l.jsx)("br",{}),Object(l.jsxs)(m.a,{vertical:!0,children:[Object(l.jsx)(u.a,{disabled:40===i,onClick:function(){k(40)},children:Object(l.jsx)("i",{style:{fontSize:"8pt"},className:"bi-circle-fill"})}),Object(l.jsx)(u.a,{disabled:20===i,onClick:function(){k(20)},children:Object(l.jsx)("i",{style:{fontSize:"6pt"},className:"bi-circle-fill"})}),Object(l.jsx)(u.a,{disabled:10===i,onClick:function(){k(10)},children:Object(l.jsx)("i",{style:{fontSize:"4pt"},className:"bi-circle-fill"})})]}),Object(l.jsx)("br",{}),Object(l.jsxs)(m.a,{vertical:!0,children:[Object(l.jsx)(u.a,{onClick:function(){var e=v.b();y.setItem(Object(j.a)(),{name:"New Selection",width:e.width,height:e.height,data:e.buffer}).then(C)},children:Object(l.jsx)("i",{className:"fas fa-save"})}),Object(l.jsx)(u.a,{onClick:function(){var e=document.createElement("input");e.type="file",e.onchange=function(e){var t=e.target.files[0];new Promise((function(e,n){var r=new FileReader;r.readAsArrayBuffer(t),r.onload=function(n){e([n.target.result,t.name.replace(".png","")])},r.onerror=function(e){n(r.error)},r.onabort=function(e){n("FileReader was aborted!")}})).then((function(e){var t=Object(a.a)(e,2),n=t[0],r=t[1],i=g.decode(n),o=new Uint8Array(g.toRGBA8(i)[0]);y.setItem(Object(j.a)(),{name:r,width:i.width,height:i.height,data:o}).then(C)}))},e.click()},children:Object(l.jsx)("i",{className:"bi-upload"})})]})]})})]})};t.a=function(e){var t=Object(r.useRef)(null),n=Object(r.useRef)(null),a=e.onMainView,i=e.onMapView;return Object(r.useEffect)((function(){a(t.current),i(n.current)}),[a,i]),Object(l.jsx)(l.Fragment,{children:Object(l.jsx)("div",{className:"views d-flex flex-col",children:Object(l.jsxs)("div",{className:"flex-fill d-flex flex-row",children:[Object(l.jsxs)("div",{className:"flex-fill stack-base",children:[Object(l.jsx)("div",{className:"stack",ref:n}),Object(l.jsx)(w,{})]}),Object(l.jsx)("div",{className:"v-divider"}),Object(l.jsxs)("div",{className:"flex-fill d-flex flex-column",children:[Object(l.jsx)("div",{className:"flex-fill stack-base",children:Object(l.jsx)("div",{className:"stack",ref:t})}),Object(l.jsx)("div",{className:"h-divider"}),Object(l.jsx)("div",{className:"flex-fill stack-base",children:Object(l.jsx)(c,{heataxes:e.heataxes,heatmap:e.heatmap,heatarea:e.heatarea,compartmentHistogram:e.compartmentHistogram,localHeatmap:e.localHeatmap,localHeatarea:e.localHeatarea})})]})]})})})}},107:function(e,t,n){"use strict";var r=n(16),a=n.n(r),i=n(22),o=n(2),s=n(3),l=n(15),c=n(4),u=n(5),m=n(0),h=n(70),d=n(19),f=n(29),p=n(17),v=n(57),x=n(1),b=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).handleChangeX=r.handleChangeX.bind(Object(l.a)(r)),r.handleChangeY=r.handleChangeY.bind(Object(l.a)(r)),r.handleChangeZ=r.handleChangeZ.bind(Object(l.a)(r)),r}return Object(s.a)(n,[{key:"handleChangeX",value:function(e){this.props.onChange({x:e.target.value,y:this.props.value.y,z:this.props.value.z})}},{key:"handleChangeY",value:function(e){this.props.onChange({x:this.props.value.x,y:e.target.value,z:this.props.value.z})}},{key:"handleChangeZ",value:function(e){this.props.onChange({x:this.props.value.x,y:this.props.value.y,z:e.target.value})}},{key:"render",value:function(){return Object(x.jsxs)(v.a,{className:"mb-3",children:[Object(x.jsx)(v.a.Text,{children:"Voxel Size"}),Object(x.jsx)(p.a.Control,{type:"number",placeholder:"x",value:this.props.value.x,onChange:this.handleChangeX}),Object(x.jsx)(p.a.Control,{type:"number",placeholder:"y",value:this.props.value.y,onChange:this.handleChangeY}),Object(x.jsx)(p.a.Control,{type:"number",placeholder:"z",value:this.props.value.z,onChange:this.handleChangeZ})]})}}]),n}(m.Component),g=function(e){Object(c.a)(n,e);var t=Object(u.a)(n);function n(e){var r;return Object(o.a)(this,n),(r=t.call(this,e)).state={fileProtein:"",fileSegmentation:"",voxelSize:{x:"",y:"",z:""},working:!1},r.handleClickImport=r.handleClickImport.bind(Object(l.a)(r)),r.handleChangeFileProtein=r.handleChangeFileProtein.bind(Object(l.a)(r)),r.handleChangeFileSegmentation=r.handleChangeFileSegmentation.bind(Object(l.a)(r)),r.handleChangeVoxelSize=r.handleChangeVoxelSize.bind(Object(l.a)(r)),r.handleClose=r.handleClose.bind(Object(l.a)(r)),r}return Object(s.a)(n,[{key:"handleChangeFileProtein",value:function(e){this.setState({fileProtein:e.target.files[0]})}},{key:"handleChangeFileSegmentation",value:function(e){this.setState({fileSegmentation:e.target.files[0]})}},{key:"handleChangeVoxelSize",value:function(e){this.setState({voxelSize:e})}},{key:"handleClickImport",value:function(){var e=Object(i.a)(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.setState({working:!0}),this.props.onImport(this.state.fileProtein,this.state.fileSegmentation,this.state.voxelSize),this.setState({working:!1});case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleClose",value:function(e){this.props.onClose()}},{key:"render",value:function(){var e,t;return e=!(!(this.state.fileProtein&&this.state.fileSegmentation&&this.state.voxelSize.x&&this.state.voxelSize.y&&this.state.voxelSize.z)||this.state.working),this.props.error&&(t=Object(x.jsx)(h.a,{variant:"danger",children:this.props.error})),Object(x.jsxs)(f.a,{show:this.props.show,onHide:this.handleClose,children:[Object(x.jsx)(f.a.Header,{closeButton:!0,children:Object(x.jsx)(f.a.Title,{children:"Import Data"})}),Object(x.jsxs)(f.a.Body,{children:[Object(x.jsxs)(p.a,{children:[Object(x.jsxs)(p.a.Group,{className:"mb-3",children:[Object(x.jsx)(p.a.Label,{children:"Protein Data"}),Object(x.jsx)(p.a.Control,{type:"file",onChange:this.handleChangeFileProtein})]}),Object(x.jsxs)(p.a.Group,{className:"mb-3",children:[Object(x.jsx)(p.a.Label,{children:"Segmentation Data"}),Object(x.jsx)(p.a.Control,{type:"file",onChange:this.handleChangeFileSegmentation})]}),Object(x.jsx)(b,{value:this.state.voxelSize,onChange:this.handleChangeVoxelSize})]}),t]}),Object(x.jsx)(f.a.Footer,{children:Object(x.jsx)(d.a,{variant:"primary",disabled:!e,onClick:this.handleClickImport,children:"Import"})})]})}}]),n}(m.Component);t.a=g},108:function(e,t,n){"use strict";var r=n(2),a=n(3),i=n(4),o=n(5),s=n(0),l=n(29),c=(n(86),n(70)),u=n(85),m=n(1),h=function(e){Object(i.a)(n,e);var t=Object(o.a)(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(a.a)(n,[{key:"render",value:function(){var e="";this.props.progress>=100&&(e="success"),this.props.error&&(e="danger");var t,n=this.props.progress<100&&!this.props.error;return this.props.error&&(t=Object(m.jsx)(c.a,{variant:"danger",children:this.props.error})),Object(m.jsxs)("div",{className:"labeled-progress-bar",children:[Object(m.jsxs)(u.a,{children:[Object(m.jsx)("div",{className:"label-front",style:{clipPath:"inset(0 ".concat(100-this.props.progress,"% 0 0)")},children:this.props.label}),Object(m.jsx)("div",{className:"label-back",children:this.props.label}),Object(m.jsx)(u.a,{striped:!0,variant:e,animated:n,now:this.props.progress})]}),t]})}}]),n}(s.Component),d=h,f=function(e){Object(i.a)(n,e);var t=Object(o.a)(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(a.a)(n,[{key:"componentDidMount",value:function(){}},{key:"componentWillUnmount",value:function(){}},{key:"render",value:function(){return Object(m.jsxs)(l.a,{backdrop:"static",show:this.props.show,children:[Object(m.jsx)(l.a.Header,{children:Object(m.jsx)(l.a.Title,{children:"Importing Data..."})}),Object(m.jsx)(l.a.Body,{children:Object(m.jsxs)("div",{className:"d-grid gap-3",children:[Object(m.jsx)(d,{progress:this.props.proteinProgress,error:this.props.proteinError,label:"Decode Protein TIFF..."}),Object(m.jsx)(d,{progress:this.props.segmentationProgress,error:this.props.segmentationError,label:"Decode Segmentation TIFF..."}),Object(m.jsx)(d,{progress:this.props.sdfProgress,error:this.props.sdfError,label:"Compute Distance Fields..."}),Object(m.jsx)(d,{progress:this.props.curvProgress,error:this.props.curvError,label:"Compute Mean Curvature..."})]})})]})}}]),n}(s.Component);t.a=f},115:function(e,t,n){},119:function(e,t,n){e.exports=n.p+"static/js/local-heatmap-worker.03975bfe.chunk.worker.js"},121:function(e,t,n){e.exports=n.p+"static/js/sdf-worker.26e3c1b5.chunk.worker.js"},122:function(e,t,n){e.exports=n.p+"static/js/curv-worker.e7456c99.chunk.worker.js"},126:function(e,t,n){e.exports=n.p+"static/js/tiff-worker.a6adfe81.chunk.worker.js"},138:function(e,t){e.exports="in vec4 position;\nuniform mat4 modelview;\nuniform mat4 proj;\nuniform vec3 cameraPos;\nout vec3 vOrigin;\nout vec3 vDirection;\n\nvoid main() {\n    vOrigin = vec3( inverse( modelview ) * vec4( 0.0, 0.0, 0.0, 1.0 ) ).xyz;\n    vDirection = position.xyz - vOrigin;\n    gl_Position = proj * modelview * position;\n}"},139:function(e,t){e.exports="precision highp float;\nprecision highp sampler3D;\n\nout vec4 FragColor;\n\nuniform sampler3D volume0;\nuniform sampler3D volume1;\nuniform sampler3D volume2;\nuniform sampler3D volume3;\nuniform sampler3D volume4;\nuniform sampler3D volume5;\nuniform sampler3D volume6;\nuniform sampler3D volume7;\nuniform sampler3D volume8;\nuniform sampler3D volume9;\n\nuniform sampler3D sdf;\nuniform vec2 sdfRange;\n\nuniform sampler3D curvature;\nuniform vec2 curvatureRange;\n\nuniform sampler2D texDepth;\n\nuniform sampler2D selection;\nuniform sampler2D projection;\n\nuniform mat4 modelview;\nuniform mat4 proj;\n\nuniform vec3 volumeSize;\nuniform vec2 resolution;\n\nuniform float isovalue;\n\nuniform bool displayProtein;\nuniform bool displayCompartments;\nuniform bool useLod;\n\nuniform bool debugSamples;\n\nin vec3 vOrigin;\nin vec3 vDirection;\n\nvec2 rayBoxDst(vec3 bmin, vec3 bmax, vec3 p, vec3 d) {\n    vec3 t0 = (bmin - p) / d;\n    vec3 t1 = (bmax - p) / d;\n    vec3 tmin = min(t0, t1);\n    vec3 tmax = max(t0, t1);\n\n    float dstA = max(max(tmin.x, tmin.y), tmin.z);\n    float dstB = min(tmax.x, min(tmax.y, tmax.z));\n\n    float dstToBox = max(0.0, dstA);\n    float dstInsideBox = max(0.0, dstB - dstToBox);\n    return vec2(dstToBox, dstInsideBox);\n}\n\n// https://github.com/kbinani/colormap-shaders/blob/master/shaders/glsl/MATLAB_summer.frag\nvec3 colormap(float x) {\n    return vec3(clamp(x, 0.0, 1.0), clamp(0.5 * x + 0.5, 0.0, 1.0), 0.4);\n}\n\nvec3 matlab_spring(float x) {\n    return vec3(1.0, clamp(x, 0.0, 1.0), clamp(1.0 - x, 0.0, 1.0));\n}\n\nfloat colormap_red(float x) {\n\tif (x < 0.09771832105856419) {\n\t\treturn 7.60263247863246E+02 * x + 1.02931623931624E+02;\n\t} else if (x < 0.3017162107441106) {\n\t\treturn (-2.54380938558548E+02 * x + 4.29911571188803E+02) * x + 1.37642085716717E+02;\n\t} else if (x < 0.4014205790737471) {\n\t\treturn 8.67103448276151E+01 * x + 2.18034482758611E+02;\n\t} else if (x < 0.5019932233215039) {\n\t\treturn -6.15461538461498E+01 * x + 2.77547692307680E+02;\n\t} else if (x < 0.5969483882550937) {\n\t\treturn -3.77588522588624E+02 * x + 4.36198819698878E+02;\n\t} else if (x < 0.8046060096654594) {\n\t\treturn (-6.51345897546620E+02 * x + 2.09780968434337E+02) * x + 3.17674951640855E+02;\n\t} else {\n\t\treturn -3.08431855203590E+02 * x + 3.12956742081421E+02;\n\t}\n}\n\nfloat colormap_green(float x) {\n\tif (x < 0.09881640500975222) {\n\t\treturn 2.41408547008547E+02 * x + 3.50427350427364E-01;\n\t} else if (x < 0.5000816285610199) {\n\t\treturn ((((1.98531871433258E+04 * x - 2.64108262469187E+04) * x + 1.10991785969817E+04) * x - 1.92958444776211E+03) * x + 8.39569642882186E+02) * x - 4.82944517518776E+01;\n\t} else if (x < 0.8922355473041534) {\n\t\treturn (((6.16712686949223E+03 * x - 1.59084026055125E+04) * x + 1.45172137257997E+04) * x - 5.80944127411621E+03) * x + 1.12477959061948E+03;\n\t} else {\n\t\treturn -5.28313797313699E+02 * x + 5.78459299959206E+02;\n\t}\n}\n\nfloat colormap_blue(float x) {\n\tif (x < 0.1033699568661857) {\n\t\treturn 1.30256410256410E+02 * x + 3.08518518518519E+01;\n\t} else if (x < 0.2037526071071625) {\n\t\treturn 3.38458128078815E+02 * x + 9.33004926108412E+00;\n\t} else if (x < 0.2973267734050751) {\n\t\treturn (-1.06345054944861E+02 * x + 5.93327252747168E+02) * x - 3.81852747252658E+01;\n\t} else if (x < 0.4029109179973602) {\n\t\treturn 6.68959706959723E+02 * x - 7.00740740740798E+01;\n\t} else if (x < 0.5006715489526758) {\n\t\treturn 4.87348695652202E+02 * x + 3.09898550724286E+00;\n\t} else if (x < 0.6004396902588283) {\n\t\treturn -6.85799999999829E+01 * x + 2.81436666666663E+02;\n\t} else if (x < 0.702576607465744) {\n\t\treturn -1.81331701891043E+02 * x + 3.49137263626287E+02;\n\t} else if (x < 0.9010407030582428) {\n\t\treturn (2.06124143164576E+02 * x - 5.78166906665595E+02) * x + 5.26198653917172E+02;\n\t} else {\n\t\treturn -7.36990769230737E+02 * x + 8.36652307692262E+02;\n\t}\n}\n\nvec3 colormap_RdBu(float x) {\n    x = clamp(x, 0.0, 1.0);\n\tfloat r = clamp(colormap_red(x) / 255.0, 0.0, 1.0);\n\tfloat g = clamp(colormap_green(x) / 255.0, 0.0, 1.0);\n\tfloat b = clamp(colormap_blue(x) / 255.0, 0.0, 1.0);\n\treturn vec3(r, g, b);\n}\n\n// Sample the protein channel, local coordinates.\nvec2 sampleProtein(vec3 p, int lod) {\n    if (lod == 0) {\n        return texture(volume0, p/volumeSize + 0.5).rg;\n    } else if (lod == 1) {\n        return texture(volume1, p/volumeSize + 0.5).rg;\n    } else if (lod == 2) {\n        return texture(volume2, p/volumeSize + 0.5).rg;\n    } else if (lod == 3) {\n        return texture(volume3, p/volumeSize + 0.5).rg;\n    } else if (lod == 4) {\n        return texture(volume4, p/volumeSize + 0.5).rg;\n    } else if (lod == 5) {\n        return texture(volume5, p/volumeSize + 0.5).rg;\n    } else if (lod == 6) {\n        return texture(volume6, p/volumeSize + 0.5).rg;\n    } else if (lod == 7) {\n        return texture(volume7, p/volumeSize + 0.5).rg;\n    } else if (lod == 8) {\n        return texture(volume8, p/volumeSize + 0.5).rg;\n    } else {\n        return texture(volume9, p/volumeSize + 0.5).rg;\n    }\n}\n\nfloat sampleSdf(vec3 p) {\n    return texture(sdf, p/volumeSize + 0.5).r * (sdfRange.y - sdfRange.x) + sdfRange.x;\n}\n\nfloat sampleCurvature(vec3 p) {\n    return texture(curvature, p/volumeSize + 0.5).r * (curvatureRange.y - curvatureRange.x) + curvatureRange.x;\n}\n\nfloat sampleProjection(vec3 p) {\n    vec2 uv = (p/volumeSize + 0.5).xy;\n    float r = texture(projection, uv, 2.0).g;\n    return r;\n}\n\nvoid calcNormalAndCurv(vec3 p, out vec3 normal, out float curv) {\n    // Calculates the normal as well as the *mean* curvature at point p.\n    float h = 0.01; \n    vec2 k = h * vec2(1., 0.);\n\n    float t1 = sampleSdf(p + volumeSize*k.xyy); float t2 = sampleSdf(p - volumeSize*k.xyy);\n    float t3 = sampleSdf(p + volumeSize*k.yxy); float t4 = sampleSdf(p - volumeSize*k.yxy);\n    float t5 = sampleSdf(p + volumeSize*k.yxx); float t6 = sampleSdf(p - volumeSize*k.yxx);\n    float t = sampleSdf(p);\n\n    curv = (t1+t2+t3+t4+t5+t6-6.0*t)/(h*h); // mean curvature is just the Jacobian of the SDF\n    //curv = (abs(t1+t2-t)+abs(t3+t4-t)+abs(t5+t6-t))/(h*h);\n    normal = normalize(k.xyy * (t1-t2) + k.yxy * (t3-t4) + k.yyx * (t5-t6));\n}\n\nvoid main()\n{\n    float normalizedDepth = texture(texDepth, gl_FragCoord.xy / resolution).r;\n    vec4 ndc = vec4(gl_FragCoord.xy / resolution * 2.0 - 1.0,\n                    normalizedDepth * 2.0 - 1.0, 1.0f);\n\n    vec4 vcoords = inverse(proj) * ndc;\n    vcoords /= vcoords.w;\n    float depth = -vcoords.z;\n\n    vec3 rayDir = normalize( vDirection );\n    vec2 boxDst = rayBoxDst(-0.5 * volumeSize, 0.5 * volumeSize, vOrigin, rayDir);\n\n    // Render render isosurface\n    vec4 surfaceColor = vec4(0.0f);\n    vec4 proteinColor = vec4(0.0f);\n    vec4 selectionColor = vec4(0.0f);\n    \n    if (displayCompartments) {\n        vec3 rayPos = vOrigin + boxDst.x * rayDir;\n        float dist = 0.0;\n        while (dist < boxDst.y) {\n            if (dist + boxDst.x > depth) break;\n            // Simple sphere tracer.            \n            float sdfVal = sampleSdf(rayPos);\n            \n            if (sdfVal <= 0.01) {\n                float curv;\n                vec3 normal;\n                calcNormalAndCurv(rayPos, normal, curv);\n                curv = sampleCurvature(rayPos);\n                float normalized_curv = curv + 0.5;\n                float ldn = dot(normal, vec3(1.0, 0.0, 0.0));\n                surfaceColor = mix(vec4(0.5*colormap_RdBu(normalized_curv), 1.0), vec4(colormap_RdBu(normalized_curv), 1.0), 0.5 + 0.5 * ldn);\n                break;\n            }\n\n            dist += sdfVal;\n            rayPos += sdfVal * rayDir;\n        }\n        depth = min(depth, boxDst.x + dist);\n    }\n\n    // Render volume.\n    float steps = 0.0;\n    vec3 rayPos = vOrigin + boxDst.x * rayDir;\n\n    float baseStepSize = 0.25;\n    float dist = 0.0;\n\n    // This works better than an if statement for some reason (at least on Intel GPUs)\n    float dstToMarch = float(displayProtein)*boxDst.y;\n\n    while (dist < dstToMarch) {\n        float sdfVal = sampleSdf(rayPos);\n\n        float stepSize = baseStepSize;\n        if (sdfVal <= isovalue + 0.00001) {\n            int lod = 0;\n            \n            if (useLod) {\n                if (dist + boxDst.x < 40.0) {\n                    lod = 0;\n                    stepSize = baseStepSize;\n                } else if (dist + boxDst.x < 80.0) {\n                    lod = 1;\n                    stepSize = baseStepSize * 2.0;\n                } else if (dist + boxDst.x < 160.0) {\n                    lod = 2;\n                    stepSize = baseStepSize * 4.0;\n                } else {\n                    lod = 3;\n                    stepSize = baseStepSize * 8.0;\n                }\n            }\n\n            float density = 0.75 * sampleProtein(rayPos, lod).r;\n            vec3 color = colormap(density);\n\n            vec3 uvw = rayPos / volumeSize + 0.5;\n            float selectionMask = texture(selection, uvw.xy).r;\n\n            color = mix(color, 3.0 * matlab_spring(density), selectionMask);\n\n            proteinColor.rgb += density * (1.0 - proteinColor.a) * color;\n            proteinColor.a += density * (1.0 - proteinColor.a);\n        }\n\n        dist += stepSize;\n        rayPos += stepSize * rayDir;\n\n        steps += 1.0;\n\n        //if (proteinColor.a > 0.99f) break;\n        if (dist + boxDst.x > depth) break;\n    }\n\n    if (debugSamples) {\n        FragColor.rgb = matlab_spring(steps / 500.0);\n        FragColor.a = 1.0;\n    } else {\n        FragColor.rgb = mix(surfaceColor.rgb, proteinColor.rgb, proteinColor.a);\n        FragColor.a = max(surfaceColor.a, proteinColor.a);\n\n        FragColor.rgb = mix(FragColor.rgb, selectionColor.rgb, selectionColor.a);\n        FragColor.a = max(FragColor.a, selectionColor.a);\n    }\n}"},140:function(e,t){e.exports="varying vec2 vUv;\n\nvoid main() {\n    vUv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}"},141:function(e,t){e.exports="\nvarying vec2 vUv;\n\nuniform sampler2D texGrid;\nuniform sampler2D texVolume;\n\nvoid main() {\n    gl_FragColor = vec4(mix(texture(texGrid, vUv).rgb, texture(texVolume, vUv).rgb, texture(texVolume, vUv).a), 1.0);\n}"},142:function(e,t){e.exports="varying vec2 vUv;\n\nvoid main() {\n    vUv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}"},143:function(e,t){e.exports="varying vec2 vUv;\n\nuniform highp sampler3D volume;\nuniform highp sampler3D sdf;\nuniform vec2 sdfRange;\nuniform float isovalue;\n\nvoid main() {\n    vec3 uv = vec3(vUv, 0.0);\n    int col = textureSize(volume, 0).z;\n\n    // Maximum projection.\n    float maxDensity = 0.0;\n    float maxPos = 0.0;\n    for (float i = 0.0; i < float(col); i += 1.0) {\n        uv.z = i / float(col);\n        float sdfVal = texture(sdf, uv).r * (sdfRange.y - sdfRange.x) + sdfRange.x - isovalue;\n        if (sdfVal <= 0.00001) {\n            float density = texture(volume, uv).r;\n            if (density > maxDensity) {\n                maxDensity = density;\n                maxPos = uv.z;\n            }\n        }\n    }\n\n    gl_FragColor = vec4(maxDensity, maxPos, 0.0, 1.0);\n}"},144:function(e,t){e.exports="varying vec2 vUv;\n\nvoid main() {\n    vUv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}"},145:function(e,t){e.exports="varying vec2 vUv;\n\nuniform bool clear;\nuniform vec2 lastPosition;\nuniform vec2 position;\nuniform bool depressed;\nuniform float resolution;\nuniform int penMode;\nuniform float penSize;\nuniform sampler2D restore;\nuniform bool doRestore;\n\n// https://iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm\nfloat sdSegment( in vec2 p, in vec2 a, in vec2 b )\n{\n    vec2 pa = p-a, ba = b-a;\n    float h = clamp( dot(pa,ba)/dot(ba,ba), 0.0, 1.0 );\n    return length( pa - ba*h );\n}\n\nvoid drawPixel() {\n    gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n}\n\nvoid erasePixel() {\n    gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n}\n\nvoid main()\n{\n    if (clear) {\n        erasePixel();\n        return;\n    }\n\n    if (doRestore) {\n        gl_FragColor = texture(restore, vUv);\n        return;\n    }\n\n    if (sdSegment(vUv, position, lastPosition) < penSize/resolution && depressed) {\n        if (penMode == 0) {\n            drawPixel();\n        } else {\n            erasePixel();\n        }\n    } else {\n        discard;\n    }\n}"},146:function(e,t){e.exports="varying vec2 vUv;\n\nvoid main() {\n    vUv = uv;\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);\n}"},147:function(e,t){e.exports="varying vec2 vUv;\n\nuniform highp sampler2D projection;\nuniform highp sampler2D selection;\n\n// https://github.com/kbinani/colormap-shaders/blob/master/shaders/glsl/MATLAB_summer.frag\nvec4 colormap(float x) {\n    return vec4(clamp(x, 0.0, 1.0), clamp(0.5 * x + 0.5, 0.0, 1.0), 0.4, 1.0);\n}\n\nvoid main() {\n    vec4 c1 = colormap(texture(projection, vUv).r);\n    vec4 c2 = texture(selection, vUv);\n\n    gl_FragColor = mix(0.8*c1, c1, c2.r);\n}"},148:function(e,t,n){"use strict";n.r(t);var r=n(0),a=n.n(r),i=n(33),o=n.n(i),s=(n(115),n(86),n(116),n(117),n(118),n(94)),l=n(1);var c=function(){return Object(l.jsx)("div",{className:"App",children:Object(l.jsx)(s.a,{})})},u=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,156)).then((function(t){var n=t.getCLS,r=t.getFID,a=t.getFCP,i=t.getLCP,o=t.getTTFB;n(e),r(e),a(e),i(e),o(e)}))};"serviceWorker"in navigator&&window.addEventListener("load",(function(){navigator.serviceWorker.register("./service-worker.js").then((function(e){console.log("SW registered: ",e)})).catch((function(e){console.log("SW registration failed: ",e)}))})),o.a.render(Object(l.jsx)(a.a.StrictMode,{children:Object(l.jsx)(c,{})}),document.getElementById("root")),u()},20:function(e,t,n){"use strict";n.d(t,"c",(function(){return S})),n.d(t,"l",(function(){return k})),n.d(t,"m",(function(){return C})),n.d(t,"i",(function(){return E})),n.d(t,"p",(function(){return D})),n.d(t,"e",(function(){return z})),n.d(t,"j",(function(){return A})),n.d(t,"h",(function(){return U})),n.d(t,"g",(function(){return H})),n.d(t,"d",(function(){return L})),n.d(t,"r",(function(){return P})),n.d(t,"a",(function(){return N})),n.d(t,"k",(function(){return _})),n.d(t,"b",(function(){return B})),n.d(t,"f",(function(){return G})),n.d(t,"q",(function(){return W})),n.d(t,"n",(function(){return q})),n.d(t,"o",(function(){return X}));var r=n(16),a=n.n(r),i=n(22),o=n(7),s=(n(137),n(2)),l=n(3),c=n(4),u=n(5),m=function(){function e(){Object(s.a)(this,e)}return Object(l.a)(e,[{key:"render",value:function(){}},{key:"setVolumeSize",value:function(e,t,n){}},{key:"setProteinData",value:function(e){}},{key:"setDistanceData",value:function(e,t){}},{key:"setCurvatureData",value:function(e){}},{key:"setIsovalue",value:function(e){}},{key:"setCompartmentIndex",value:function(e){}},{key:"setDisplayCompartments",value:function(e){}},{key:"setDisplayProtein",value:function(e){}},{key:"resizeCallback",value:function(){}},{key:"setSkeleton",value:function(e){}},{key:"selectionUpdated",value:function(){}},{key:"setDebugSamples",value:function(e){}},{key:"setUseLod",value:function(e){}}]),e}(),h=n(75);o.p.DefaultUp=new o.F(0,0,1);var d,f,p,v,x=function(e){Object(c.a)(r,e);var t=Object(u.a)(r);function r(e,a){var i;Object(s.a)(this,r),(i=t.call(this)).dom=a,i.renderer=e,i.camera=new o.r(75,a.clientWidth/a.clientHeight,.1,5e3),i.controls=new h.a(i.camera,a),i.camera.position.y=-85,i.controls.update(),i.materialMarchVolume=new o.w({glslVersion:o.i,uniforms:{modelview:{value:i.camera.matrixWorldInverse},proj:{value:i.camera.projectionMatrix},resolution:{value:new o.E(0,0)},volume0:{value:null},volume1:{value:null},volume2:{value:null},volume3:{value:null},volume4:{value:null},volume5:{value:null},volume6:{value:null},volume7:{value:null},volume8:{value:null},volume9:{value:null},volumeSize:{value:null},texDepth:{value:null},sdf:{value:null},sdfRange:{value:new o.E(0,0)},curvature:{value:null},curvatureRange:{value:new o.E(0,0)},isovalue:{value:null},displayProtein:{value:!1},displayCompartments:{value:!1},selection:{value:!1},projection:{value:!1},debugSamples:{value:!1},useLod:{value:!0}},vertexShader:n(138),fragmentShader:n(139),side:o.a,transparent:!0}),i.materialCompose=new o.A({vertexShader:n(140),fragmentShader:n(141),uniforms:{texGrid:{value:null},texVolume:{value:null}},transparent:!0}),i.sceneGrid=new o.z;i.grid=new o.j(10,10),i.grid.rotateX(.5*Math.PI),i.sceneGrid.add(i.grid),i.grid.onBeforeRender=function(e,t,n,r,a,o){var s=i.controls.target;i.grid.position.x=s.x,i.grid.position.y=s.y,i.grid.position.z=s.z,i.grid.updateMatrixWorld()};var l=new o.b;i.sceneVolume=new o.z,i.box=new o.n(l,i.materialMarchVolume),i.sceneVolume.add(i.box),i.sceneCompose=new o.z,i.cameraCompose=new o.q(-1,1,1,-1,0,1);var c=new o.s(2,2),u=new o.n(c,i.materialCompose);return i.sceneCompose.add(u),i.renderTargetVolume=new o.G(0,0),i.renderTargetGrid=new o.G(0,0),i.renderTargetGrid.depthTexture=new o.g,i.materialMarchVolume.uniforms.texDepth.value=i.renderTargetGrid.depthTexture,i.materialCompose.uniforms.texGrid.value=i.renderTargetGrid.texture,i.materialCompose.uniforms.texVolume.value=i.renderTargetVolume.texture,i.volumeDirty=!0,i.controls.addEventListener("change",(function(){i.volumeDirty=!0})),window.addEventListener("resize",(function(){i.resizeCallback()})),i.resizeCallback(),i}return Object(l.a)(r,[{key:"render",value:function(){if(this.volumeTexture&&this.sdfTextures&&this.volumeDirty){var e=this.dom.getBoundingClientRect(),t=e.right-e.left,n=e.bottom-e.top,r=e.left,a=window.innerHeight-e.bottom;this.renderer.setViewport(r,a,t,n),this.renderer.setScissor(r,a,t,n),this.renderer.setScissorTest(!0),this.controls.update();var i=this.renderer.getContext();this.renderer.setRenderTarget(this.renderTargetGrid),i.clear(i.COLOR_BUFFER_BIT),this.renderer.render(this.sceneGrid,this.camera),this.renderer.setRenderTarget(this.renderTargetVolume),i.clear(i.COLOR_BUFFER_BIT),this.renderer.render(this.sceneVolume,this.camera),this.renderer.setRenderTarget(null),i.clear(i.COLOR_BUFFER_BIT),this.renderer.render(this.sceneCompose,this.cameraCompose),this.volumeDirty=!1}}},{key:"selectionUpdated",value:function(){this.volumeDirty=!0}},{key:"setVolumeSize",value:function(e,t,n){this.volumeSize=new o.F(e,t,n),this.box.geometry=new o.b(this.volumeSize.x,this.volumeSize.y,this.volumeSize.z),this.materialMarchVolume.uniforms.volumeSize.value=this.volumeSize,this.volumeDirty=!0}},{key:"setProteinData",value:function(e){this.volumeTexture=e;for(var t=0;t<9;++t)this.materialMarchVolume.uniforms["volume"+t].value=this.volumeTexture[t];this.volumeDirty=!0}},{key:"setDistanceData",value:function(e,t,n){this.sdfTextures=e,this.sdfRanges=t,this.materialMarchVolume.uniforms.sdf.value=this.sdfTextures[0],this.materialMarchVolume.uniforms.sdfRange.value=new o.E(this.sdfRanges[0][0],this.sdfRanges[0][1]),this.volumeDirty=!0}},{key:"setCurvatureData",value:function(e,t){this.curvatureTexture=e,this.curvatureRange=t,this.materialMarchVolume.uniforms.curvature.value=this.curvatureTexture,this.materialMarchVolume.uniforms.curvatureRange.value=new o.E(this.curvatureRange[0],this.curvatureRange[1]),this.volumeDirty=!0}},{key:"setIsovalue",value:function(e){this.materialMarchVolume.uniforms.isovalue.value=e}},{key:"setCompartmentIndex",value:function(e){this.materialMarchVolume.uniforms.sdf.value=this.sdfTextures[e],this.materialMarchVolume.uniforms.sdfRange.value=new o.E(this.sdfRanges[e][0],this.sdfRanges[e][1]),this.volumeDirty=!0}},{key:"setDisplayCompartments",value:function(e){this.materialMarchVolume.uniforms.displayCompartments.value=e,this.volumeDirty=!0}},{key:"setDisplayProtein",value:function(e){this.materialMarchVolume.uniforms.displayProtein.value=e,this.volumeDirty=!0}},{key:"setSelectionTexture",value:function(e){this.materialMarchVolume.uniforms.selection.value=e,this.volumeDirty=!0}},{key:"setProjectionTexture",value:function(e){this.materialMarchVolume.uniforms.projection.value=e,this.volumeDirty=!0}},{key:"resizeCallback",value:function(){this.renderer.setSize(window.innerWidth,window.innerHeight);var e=this.dom.getBoundingClientRect(),t=e.right-e.left,n=e.bottom-e.top;this.camera.aspect=t/n,this.camera.updateProjectionMatrix(),this.renderTargetVolume.setSize(t,n),this.renderTargetGrid.setSize(t,n),this.materialMarchVolume.uniforms.resolution.value=new o.E(t,n),this.renderTargetGrid.depthTexture=new o.g,this.materialMarchVolume.uniforms.texDepth.value=this.renderTargetGrid.depthTexture,this.volumeDirty=!0}},{key:"setSkeleton",value:function(e){var t=new o.d;t.setAttribute("position",new o.c(e,3));var n=new o.t(t);n.position.x=-.5*this.volumeSize.x,n.position.y=-.5*this.volumeSize.y,n.position.z=-.5*this.volumeSize.z,this.sceneGrid.add(n)}},{key:"setDebugSamples",value:function(e){this.materialMarchVolume.uniforms.debugSamples.value=e}},{key:"setUseLod",value:function(e){this.materialMarchVolume.uniforms.useLod.value=e}}]),r}(m),b=function(){function e(t,r,a,i,l){var c=this;Object(s.a)(this,e),this.dom=r,this.renderer=t,this.onSelectionUpdated=a,this.onProjectionUpdated=i,this.onSelectionDone=l,this.materialProjection=new o.A({vertexShader:n(142),fragmentShader:n(143),uniforms:{volume:{value:null},sdf:{value:null},sdfRange:{value:new o.E(0,0)},isovalue:{value:null}},transparent:!0,extensions:{shaderTextureLOD:!0}}),this.materialSelection=new o.A({vertexShader:n(144),fragmentShader:n(145),uniforms:{clear:{value:!0},lastPosition:{value:new o.E(0,0)},position:{value:new o.E(0,0)},depressed:{value:!1},penMode:{value:0},penSize:{value:8},resolution:{value:1024},restore:{value:null},doRestore:{value:!1}},transparent:!0}),this.materialMap=new o.A({vertexShader:n(146),fragmentShader:n(147),uniforms:{selection:{value:null},projection:{value:null}},transparent:!0}),this.renderTargetSelection=new o.G(1024,1024),this.renderTargetProjection=new o.G(1024,1024,{magFilter:o.o,minFilter:o.l,generateMipmaps:!0});var u=r.clientWidth/r.clientHeight;this.camera=new o.q(-u,u,1,-1,0,2),this.controls=new h.a(this.camera,r),this.camera.position.z=1,this.controls.enableRotate=!1,this.controls.update(),this.cameraProjection=new o.q(-1,1,1,-1,0,2),this.sceneProjection=new o.z;var m=new o.s(2,2),d=new o.n(m,this.materialProjection);this.planeMap=d,this.sceneProjection.add(d),this.cameraSelection=new o.q(-1,1,1,-1,0,2),this.sceneSelection=new o.z;var f=new o.s(2,2),p=new o.n(f,this.materialSelection);this.sceneSelection.add(p),this.sceneMap=new o.z;var v=new o.s(2,2),x=new o.n(v,this.materialMap);this.sceneMap.add(x),this.sceneMap.add(this.camera),this.materialMap.uniforms.projection.value=this.renderTargetProjection.texture,this.materialMap.uniforms.selection.value=this.renderTargetSelection.texture,this.projectionDirty=!1,this.selectionDirty=!1,this.dom.addEventListener("mousemove",(function(e){c.mouseMove(e)})),this.dom.addEventListener("mousedown",(function(e){c.mouseDown(e)})),this.dom.addEventListener("mouseup",(function(e){c.mouseUp(e)})),this.dom.addEventListener("mouseout",(function(e){c.mouseOut(e)})),window.addEventListener("resize",(function(){c.resizeCallback()})),this.resizeCallback()}return Object(l.a)(e,[{key:"getMousePosition",value:function(e){var t=new o.x,n=new o.E,r=this.dom.getBoundingClientRect();n.x=(e.clientX-r.left)/(r.right-r.left)*2-1,n.y=1-(e.clientY-r.top)/(r.bottom-r.top)*2,t.setFromCamera(n.clone(),this.camera);var a=t.intersectObject(this.planeMap);return a.length>0?a[0].uv:null}},{key:"mouseDown",value:function(e){if(0===e.button){var t=this.getMousePosition(e);t&&(this.materialSelection.uniforms.position.value=t,this.materialSelection.uniforms.lastPosition.value=this.materialSelection.uniforms.position.value,this.selectionDirty=!0,this.materialSelection.uniforms.depressed.value=!0)}}},{key:"mouseMove",value:function(e){if(0===e.button&&this.materialSelection.uniforms.depressed.value){var t=this.getMousePosition(e);t&&(this.materialSelection.uniforms.lastPosition.value=this.materialSelection.uniforms.position.value,this.materialSelection.uniforms.position.value=t,this.selectionDirty=!0)}}},{key:"mouseOut",value:function(e){0===e.button&&(this.materialSelection.uniforms.depressed.value=!1)}},{key:"mouseUp",value:function(e){0===e.button&&(this.materialSelection.uniforms.depressed.value=!1,this.onSelectionDone())}},{key:"renderProjection",value:function(){this.renderer.setViewport(0,0,1024,1024),this.renderer.setScissorTest(!1),this.renderer.setRenderTarget(this.renderTargetProjection),this.renderer.render(this.sceneProjection,this.cameraProjection),this.onProjectionUpdated(),this.projectionDirty=!1}},{key:"renderSelection",value:function(){this.renderer.setViewport(0,0,1024,1024),this.renderer.setScissorTest(!1),this.renderer.setRenderTarget(this.renderTargetSelection),this.renderer.render(this.sceneSelection,this.cameraSelection),this.materialSelection.uniforms.clear.value&&(this.materialSelection.uniforms.clear.value=!1,this.onSelectionDone()),this.materialSelection.uniforms.doRestore.value&&(this.materialSelection.uniforms.doRestore.value=!1,this.onSelectionDone()),this.selectionDirty=!1}},{key:"renderMap",value:function(){var e=this.dom.getBoundingClientRect(),t=e.right-e.left,n=e.bottom-e.top,r=e.left,a=window.innerHeight-e.bottom;this.renderer.setViewport(r,a,t,n),this.renderer.setScissor(r,a,t,n),this.renderer.setScissorTest(!0),this.renderer.setRenderTarget(null);var i=this.renderer.getContext();i.clear(i.COLOR_BUFFER_BIT),this.renderer.render(this.sceneMap,this.camera)}},{key:"render",value:function(){this.selectionDirty&&this.renderSelection(),this.projectionDirty&&this.renderProjection(),this.renderMap()}},{key:"setVolumeSize",value:function(e,t,n){}},{key:"setProteinData",value:function(e){this.volumeTexture=e,this.materialProjection.uniforms.volume.value=this.volumeTexture,this.projectionDirty=!0}},{key:"setDistanceData",value:function(e,t){this.sdfTextures=e,this.sdfRanges=t,this.materialProjection.uniforms.sdf.value=this.sdfTextures[0],this.materialProjection.uniforms.sdfRange.value=new o.F(this.sdfRanges[0][0],this.sdfRanges[0][1]),this.projectionDirty=!0}},{key:"setIsovalue",value:function(e){this.materialProjection.uniforms.isovalue.value=e,this.projectionDirty=!0}},{key:"setCompartmentIndex",value:function(e){this.materialProjection.uniforms.sdf.value=this.sdfTextures[e],this.materialProjection.uniforms.sdfRange.value=new o.F(this.sdfRanges[e][0],this.sdfRanges[e][1]),this.projectionDirty=!0}},{key:"setPenSize",value:function(e){this.materialSelection.uniforms.penSize.value=e}},{key:"setPenMode",value:function(e){this.materialSelection.uniforms.penMode.value="draw"===e?0:1}},{key:"getSeletionTexture",value:function(){return this.renderTargetSelection.texture}},{key:"getSelectionPixels",value:function(){var e={width:this.renderTargetSelection.width,height:this.renderTargetSelection.height,buffer:new Uint8Array(this.renderTargetSelection.width*this.renderTargetSelection.width*4)};return this.renderer.readRenderTargetPixels(this.renderTargetSelection,0,0,e.width,e.height,e.buffer),e}},{key:"setSelectionFromTexture",value:function(e){this.materialSelection.uniforms.doRestore.value=!0,this.materialSelection.uniforms.restore.value=e,this.selectionDirty=!0}},{key:"getProjectionPixels",value:function(){var e={width:this.renderTargetProjection.width,height:this.renderTargetProjection.height,buffer:new Uint8Array(this.renderTargetProjection.width*this.renderTargetProjection.width*4)};return this.renderer.readRenderTargetPixels(this.renderTargetProjection,0,0,e.width,e.height,e.buffer),e}},{key:"getProjectionTexture",value:function(){return this.renderTargetProjection.texture}},{key:"deleteSelection",value:function(){this.materialSelection.uniforms.clear.value=!0,this.selectionDirty=!0}},{key:"resizeCallback",value:function(){this.renderer.setSize(window.innerWidth,window.innerHeight);var e=this.dom.clientWidth/this.dom.clientHeight;this.camera.left=-e,this.camera.right=e,this.camera.updateProjectionMatrix()}}]),e}(),g=null,j=null,y=function(){},w=function(){};function S(e,t,n){return O.apply(this,arguments)}function O(){return(O=Object(i.a)(a.a.mark((function e(t,n,r){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d=t,f=n,p=r,(v=new o.H({canvas:d,preserveDrawingBuffer:!0})).autoClearColor=!1,e.next=7,V();case 7:M();case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){y=e}function C(e){w=e}function P(e){g.setVolumeSize(e[0],e[1],e[2])}function D(e,t){for(var n=[],r=t[0],a=t[1],i=t[2],s=0;s<e.length;++s){var l=new o.f(e[s],r,a,i);l.format=o.y,l.type=o.D,l.internalFormat="R8",l.minFilter=o.k,l.magFilter=o.k,l.generateMipmaps=!1,l.unpackAlignment=1,r=Math.ceil(r/2),a=Math.ceil(a/2),i=Math.ceil(i/2),n.push(l)}g.setProteinData(n),j.setProteinData(n[0])}function E(e,t){for(var n=[],r=[],a=0;a<e.length;++a){var i=new o.f(e[a].data,t[0],t[1],t[2]);i.format=o.y,i.minFilter=o.k,i.magFilter=o.k,i.unpackAlignment=1,n.push(i),r.push([e[a].min,e[a].max])}g.setDistanceData(n,r),j.setDistanceData(n,r)}function z(e,t){var n=new o.f(e.data,t[0],t[1],t[2]),r=[e.min,e.max];n.format=o.y,n.minFilter=o.k,n.magFilter=o.k,n.unpackAlignment=1,g.setCurvatureData(n,r)}function V(){return T.apply(this,arguments)}function T(){return(T=Object(i.a)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:g=new x(v,f),j=new b(v,p,F,R,I),g.setSelectionTexture(j.getSeletionTexture()),g.setProjectionTexture(j.getProjectionTexture());case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(){requestAnimationFrame(M),g.render(),j.render(),undefined.update()}function I(){w(j.getSelectionPixels())}function F(){g.selectionUpdated()}function R(){y(j.getProjectionPixels())}function A(e){g.setIsovalue(e),j.setIsovalue(e)}function U(e){g.setDisplayProtein(e)}function H(e){g.setDisplayCompartments(e)}function L(e){g.setCompartmentIndex(e),j.setCompartmentIndex(e)}function N(){j&&j.deleteSelection()}function B(){return j.getSelectionPixels()}function _(e,t,n){var r=new o.e(e,t,n,o.v);j.setSelectionFromTexture(r)}function G(e){g.setDebugSamples(e)}function W(e){g.setUseLod(e)}function q(e){j&&j.setPenMode(e)}function X(e){j&&j.setPenSize(e)}},83:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return u}));var r=n(16),a=n.n(r),i=n(22),o=n(2),s=n(3),l=n(97),c=n(28),u=function(){function t(){Object(o.a)(this,t),this.buffer=null,this.pixels=new Uint8Array,this.width=0,this.height=0,this.depth=0,this.bits=0}return Object(s.a)(t,[{key:"open",value:function(){var e=Object(i.a)(a.a.mark((function e(t){var n,r,i,o,s;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e,n){var r=new FileReader;r.readAsArrayBuffer(t),r.onload=function(t){e(t.target.result)},r.onerror=function(e){n(r.error)},r.onabort=function(e){n("FileReader was aborted!")}}));case 2:if(n=e.sent,r=l.decode(n),0!==Object.keys(r[0]).length){e.next=6;break}throw new Error("Could not decode TIFF file!");case 6:if(c=r[0],1===(i={t256:c.t256,t257:c.t257,t258:c.t258,t277:c.t277}).t277[0]){e.next=9;break}throw new Error("Only grayscale images are supported.");case 9:if(8===i.t258[0]){e.next=11;break}throw new Error("Only images with bit depth 8 are supported.");case 11:o=0;case 12:if(!(o<r.length)){e.next=19;break}if(a=r[o],s={t256:a.t256,t257:a.t257,t258:a.t258,t277:a.t277},JSON.stringify(i)===JSON.stringify(s)){e.next=16;break}throw new Error("Slice "+o+" has incorrect dimensions or pixel depth.");case 16:++o,e.next=12;break;case 19:this.buffer=n,this.width=i.t256[0],this.height=i.t257[0],this.depth=r.length,this.bits=i.t258[0];case 24:case"end":return e.stop()}var a,c}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"decode",value:function(){var t=Object(i.a)(a.a.mark((function t(n,r){var i,o;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=new Worker(e,{name:"tiff-worker",type:void 0}),o=c.b(i),t.next=4,o(this.buffer,c.a(n),c.a(r));case 4:this.pixels=t.sent,i.terminate();case 6:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()}]),t}()}).call(this,n(126))},86:function(e,t,n){},94:function(e,t,n){"use strict";(function(e){var r=n(16),a=n.n(r),i=n(22),o=n(2),s=n(3),l=n(15),c=n(4),u=n(5),m=n(0),h=n(95),d=n(98),f=n(99),p=n(102),v=n(106),x=n(105),b=n(19),g=n(28),j=n(1),y=function(t){Object(c.a)(r,t);var n=Object(u.a)(r);function r(e){var t;return Object(o.a)(this,r),(t=n.call(this,e)).state={fullscreen:!1,showSidebar:!1,showImport:!1,voxelSize:[0,0,0],volumeDims:[0,0,0],sdf:[],protein:"",curvature:"",ready:!1,compartmentIndex:0,displaySegmentation:!0,displayProtein:!0,isovalue:0,heatmap:[],heatarea:[],heataxes:[[0,0],[0,0]],compartmentHistogram:[],localHeatmap:[],localHeatarea:[],debugSamples:!1,useLod:!0,mainView:"",mapView:"",projectionPixels:[],selectionPixels:[]},t.handleShowImport=t.handleShowImport.bind(Object(l.a)(t)),t.handleToggleFullscreen=t.handleToggleFullscreen.bind(Object(l.a)(t)),t.handleToggleSidebar=t.handleToggleSidebar.bind(Object(l.a)(t)),t.handleAbortImport=t.handleAbortImport.bind(Object(l.a)(t)),t.handleCompleteImport=t.handleCompleteImport.bind(Object(l.a)(t)),t.handleCompartmentSelection=t.handleCompartmentSelection.bind(Object(l.a)(t)),t.handleDisplaySegmentation=t.handleDisplaySegmentation.bind(Object(l.a)(t)),t.handleDisplayProtein=t.handleDisplayProtein.bind(Object(l.a)(t)),t.handleDebugSamples=t.handleDebugSamples.bind(Object(l.a)(t)),t.handleUseLod=t.handleUseLod.bind(Object(l.a)(t)),t.handleIsovalue=t.handleIsovalue.bind(Object(l.a)(t)),t.handleMainView=t.handleMainView.bind(Object(l.a)(t)),t.handleMapView=t.handleMapView.bind(Object(l.a)(t)),t.handleProjectionUpdated=t.handleProjectionUpdated.bind(Object(l.a)(t)),t.handleSelectionDone=t.handleSelectionDone.bind(Object(l.a)(t)),t.computeLocalHistogram=t.computeLocalHistogram.bind(Object(l.a)(t)),t}return Object(s.a)(r,[{key:"handleShowImport",value:function(){this.setState({showImport:!0})}},{key:"handleAbortImport",value:function(){this.setState({showImport:!1})}},{key:"handleMapView",value:function(e){this.setState({mapView:e})}},{key:"handleMainView",value:function(e){this.setState({mainView:e})}},{key:"handleCompleteImport",value:function(e,t,n,r,a,i,o,s){this.setState({sdf:e,protein:t,volumeDims:r,curvature:n,voxelSize:a,showImport:!1,ready:!0,heatmap:i,heatarea:o,heataxes:[[e[0].min,e[0].max],[n.min,n.max]],compartmentHistogram:s})}},{key:"handleToggleFullscreen",value:function(){if(this.state.fullscreen)document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen();else{var e=document.documentElement;e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.msRequestFullscreen&&e.msRequestFullscreen()}this.setState({fullscreen:!this.state.fullscreen})}},{key:"handleToggleSidebar",value:function(){this.setState({showSidebar:!this.state.showSidebar})}},{key:"handleCompartmentSelection",value:function(e){this.setState({compartmentIndex:e})}},{key:"handleDisplaySegmentation",value:function(e){this.setState({displaySegmentation:e})}},{key:"handleDisplayProtein",value:function(e){this.setState({displayProtein:e})}},{key:"handleDebugSamples",value:function(e){this.setState({debugSamples:e})}},{key:"handleUseLod",value:function(e){this.setState({useLod:e})}},{key:"handleIsovalue",value:function(e){var t=e/100*(this.state.sdf[0].max-this.state.sdf[0].min)+this.state.sdf[0].min;this.setState({isovalue:t})}},{key:"computeLocalHistogram",value:function(){var t=Object(i.a)(a.a.mark((function t(n,r){var i,o,s,l,c,u,m;return a.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n.buffer||!r.buffer){t.next=14;break}return i=new Worker(e,{name:"local-heatmap-worker",type:void 0}),o=g.b(i),t.next=5,o(this.state.sdf[0].data,this.state.curvature.data,this.state.protein[0],this.state.volumeDims,n,r);case 5:for(s=t.sent,i.terminate(),l=Array.from(s.slice(0,65536)),c=[];l.length;)c.push(l.splice(0,256));for(u=Array.from(s.slice(65536)),m=[];u.length;)m.push(u.splice(0,256));this.setState({localHeatmap:c,localHeatarea:m});case 14:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"handleProjectionUpdated",value:function(e){this.setState({projectionPixels:e})}},{key:"handleSelectionDone",value:function(e){this.setState({selectionPixels:e}),this.computeLocalHistogram(e,this.state.projectionPixels)}},{key:"render",value:function(){var e=[this.state.volumeDims[0]*this.state.voxelSize[0],this.state.volumeDims[1]*this.state.voxelSize[1],this.state.volumeDims[2]*this.state.voxelSize[2]];return Object(j.jsxs)(j.Fragment,{children:[Object(j.jsx)("div",{className:"background"}),Object(j.jsx)(h.a,{show:this.state.showImport,onAbort:this.handleAbortImport,onComplete:this.handleCompleteImport}),!this.state.ready&&Object(j.jsx)("div",{className:"d-flex justify-content-center align-items-center",style:{position:"absolute",height:"100%",width:"100%"},children:Object(j.jsxs)(b.a,{variant:"primary",size:"lg",onClick:this.handleShowImport,children:[Object(j.jsx)("i",{className:"bi-plus-square"}),"\xa0\xa0Import Data"]})}),this.state.ready&&Object(j.jsxs)(j.Fragment,{children:[Object(j.jsx)(x.a,{mainView:this.state.mainView,mapView:this.state.mapView,volumeDims:this.state.volumeDims,sdf:this.state.sdf,protein:this.state.protein,curvature:this.state.curvature,volumeSize:e,displayProtein:this.state.displayProtein,displaySegmentation:this.state.displaySegmentation,compartmentIndex:this.state.compartmentIndex,ready:this.state.ready,debugSamples:this.state.debugSamples,useLod:this.state.useLod,isovalue:this.state.isovalue,onProjectionUpdated:this.handleProjectionUpdated,onSelectionDone:this.handleSelectionDone}),Object(j.jsxs)(p.a,{children:[Object(j.jsx)(d.a,{fullscreen:this.state.fullscreen,onImportData:this.handleShowImport,onToggleFullscreen:this.handleToggleFullscreen,onToggleSidebar:this.handleToggleSidebar}),Object(j.jsx)(f.a,{open:this.state.showSidebar,numCompartments:this.state.sdf.length,onCompartmentSelection:this.handleCompartmentSelection,selection:this.state.compartmentIndex,onDisplaySegmentation:this.handleDisplaySegmentation,onDisplayProtein:this.handleDisplayProtein,onDebugSamples:this.handleDebugSamples,onUseLod:this.handleUseLod,onIsovalue:this.handleIsovalue,displayProtein:this.state.displayProtein,displaySegmentation:this.state.displaySegmentation})]}),Object(j.jsx)(v.a,{heataxes:this.state.heataxes,heatmap:Array.from(this.state.heatmap),heatarea:Array.from(this.state.heatarea),compartmentHistogram:this.state.compartmentHistogram,localHeatmap:Array.from(this.state.localHeatmap),localHeatarea:Array.from(this.state.localHeatarea),onMainView:this.handleMainView,onMapView:this.handleMapView})]})]})}}]),r}(m.Component);t.a=y}).call(this,n(119))},95:function(e,t,n){"use strict";(function(e,r){var a=n(16),i=n.n(a),o=n(22),s=n(2),l=n(3),c=n(15),u=n(4),m=n(5),h=n(0),d=n(107),f=n(108),p=n(28),v=n(83),x=n(1),b=function(t){Object(u.a)(a,t);var n=Object(m.a)(a);function a(e){var t;return Object(s.a)(this,a),(t=n.call(this,e)).state={tiffProtein:"",tiffSegmentation:"",voxelSize:"",proteinProgress:0,segmentationProgress:0,sdfProgress:0,curvProgress:0,proteinError:"",segmentationError:"",sdfError:"",curvError:"",step:"dialog",preImportError:""},t.handleImport=t.handleImport.bind(Object(c.a)(t)),t.handleClose=t.handleClose.bind(Object(c.a)(t)),t.onProteinProgress=t.onProteinProgress.bind(Object(c.a)(t)),t.onSegmentationProgress=t.onSegmentationProgress.bind(Object(c.a)(t)),t.onProteinError=t.onProteinError.bind(Object(c.a)(t)),t.onSegmentationError=t.onSegmentationError.bind(Object(c.a)(t)),t.onSdfProgress=t.onSdfProgress.bind(Object(c.a)(t)),t.onSdfError=t.onSdfError.bind(Object(c.a)(t)),t}return Object(l.a)(a,[{key:"onProteinProgress",value:function(e){this.setState({proteinProgress:e})}},{key:"onSegmentationProgress",value:function(e){this.setState({segmentationProgress:e})}},{key:"onProteinError",value:function(e){this.setState({proteinError:e})}},{key:"onSegmentationError",value:function(e){this.setState({segmentationError:e})}},{key:"onSdfProgress",value:function(e){this.setState({sdfProgress:e})}},{key:"onSdfError",value:function(e){this.setState({sdfError:e})}},{key:"onCurvProgress",value:function(e){this.setState({curvProgress:e})}},{key:"onCurvError",value:function(e){this.setState({curvError:e})}},{key:"handleImport",value:function(){var t=Object(o.a)(i.a.mark((function t(n,a,o){var s,l,c,u,m,h,d,f,x,b,g,j,y,w,S,O,k,C,P,D,E,z,V,T,M,I,F,R,A,U,H,L,N,B,_,G,W,q,X,Y,J,Z=this;return i.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return s=new v.a,l=new v.a,t.prev=2,t.next=5,s.open(n);case 5:return t.next=7,l.open(a);case 7:t.next=13;break;case 9:return t.prev=9,t.t0=t.catch(2),this.setState({preImportError:t.t0.message}),t.abrupt("return");case 13:if(s.width===l.width&&s.height===l.height&&s.depth===l.depth){t.next=16;break}return this.setState({preImportError:"Please make sure the protein and the segmentation data have the same dimensions."}),t.abrupt("return");case 16:return this.setState({step:"import",voxelSize:o,tiffProtein:s,tiffSegmentation:l,segmentationProgress:0,proteinProgress:0,sdfProgress:0,segmentationError:"",proteinError:"",sdfError:""}),t.next=19,s.decode(this.onProteinError,this.onProteinProgress);case 19:return t.next=21,l.decode(this.onSegmentationError,this.onSegmentationProgress);case 21:for(c=function(e,t){return Math.max(e,t)},u=l.pixels.reduce(c),m=[],h=[],d=new Array(u+1),f=function(t){var n=t,r=function(e){d[n]=100*e,Z.onSdfProgress(d.reduce((function(e,t){return e+t}),0)/(u+1))};m.push(new Promise((function(t,a){var i=new Worker(e,{name:"sdf-worker",type:void 0});h.push(i),t(p.b(i)(l,o,n,p.a(r)))})))},x=0;x<u+1;++x)f(x);b=[],g=0;case 30:if(!(g<m.length)){t.next=39;break}return t.t1=b,t.next=34,m[g];case 34:t.t2=t.sent,t.t1.push.call(t.t1,t.t2);case 36:++g,t.next=30;break;case 39:for(j=0;j<h.length;++j)h[j].terminate();return this.onSdfProgress(100),y=new Worker(r,{name:"curv-worker",type:void 0}),w=p.b(y),S=function(e){Z.onCurvProgress(100*e)},t.next=46,w(b[0],[s.width,s.height,s.depth],o,p.a(S));case 46:for(O=t.sent,k=[],C=s.width,P=s.height,D=s.depth,E=new Uint8Array(C*P*D),z=0;z<C;++z)for(V=0;V<P;++V)for(T=0;T<D;++T)E[T*C*P+V*C+z]=s.pixels[T*C*P+V*C+z];k.push(E);case 54:for(M=C,I=P,F=D,C=Math.ceil(C/2),P=Math.ceil(P/2),D=Math.ceil(D/2),R=k[k.length-1],A=new Uint8Array(C*P*D),U=0;U<M;++U)for(H=0;H<I;++H)for(L=0;L<F;++L)N=Math.floor(U/2),B=Math.floor(H/2),_=Math.floor(L/2),A[_*C*P+B*C+N]=Math.max(A[_*C*P+B*C+N],R[L*M*I+H*M+U]);if(k.push(A),!(C<=1||P<=1||D<=1)){t.next=67;break}return t.abrupt("break",69);case 67:t.next=54;break;case 69:for(8,G=Array.from(Array(Math.pow(2,8)).fill(0),(function(){return new Array(Math.pow(2,8)).fill(0)})),W=Array.from(Array(Math.pow(2,8)).fill(0),(function(){return new Array(Math.pow(2,8)).fill(0)})),q=Array(u).fill(0),X=Array(u).fill(0),Y=0;Y<b[0].data.length;++Y)G[O.data[Y]][b[0].data[Y]]+=s.pixels[Y],W[O.data[Y]][b[0].data[Y]]+=1,l.pixels[Y]>0&&(q[l.pixels[Y]-1]+=s.pixels[Y],X[l.pixels[Y]-1]+=1);for(J=0;J<u;++J)q[J]/=X[J];this.setState({step:"dialog"}),this.props.onComplete(b,k,O,[s.width,s.height,s.depth],[parseFloat(o.x),parseFloat(o.y),parseFloat(o.z)],G,W,q);case 78:case"end":return t.stop()}}),t,this,[[2,9]])})));return function(e,n,r){return t.apply(this,arguments)}}()},{key:"handleClose",value:function(){this.props.onAbort()}},{key:"render",value:function(){return Object(x.jsxs)(x.Fragment,{children:[Object(x.jsx)(d.a,{show:"dialog"===this.state.step&&this.props.show,error:this.state.preImportError,onImport:this.handleImport,onClose:this.handleClose}),Object(x.jsx)(f.a,{show:"import"===this.state.step&&this.props.show,proteinProgress:this.state.proteinProgress,segmentationProgress:this.state.segmentationProgress,sdfProgress:this.state.sdfProgress,curvProgress:this.state.curvProgress,proteinError:this.state.proteinError,segmentationError:this.state.segmentationError,sdfError:this.state.sdfError,curvError:this.state.curvError})]})}}]),a}(h.Component);t.a=b}).call(this,n(121),n(122))},98:function(e,t,n){"use strict";var r=n(2),a=n(3),i=n(4),o=n(5),s=n(0),l=n(19),c=n(42),u=n(74),m=n(1),h=function(e){Object(i.a)(n,e);var t=Object(o.a)(n);function n(){return Object(r.a)(this,n),t.apply(this,arguments)}return Object(a.a)(n,[{key:"render",value:function(){var e;return e=this.props.fullscreen?"bi-fullscreen-exit":"bi-arrows-fullscreen",Object(m.jsxs)(u.a,{style:{marginLeft:"auto"},children:[Object(m.jsxs)(c.a,{className:"me-2",children:[Object(m.jsx)(l.a,{onClick:this.props.onToggleSidebar,children:Object(m.jsx)("i",{className:"bi-tools"})}),Object(m.jsx)(l.a,{onClick:this.props.onImportData,children:"Import Data"})]}),Object(m.jsx)(c.a,{className:"me-2",children:Object(m.jsx)(l.a,{onClick:this.props.onToggleFullscreen,children:Object(m.jsx)("i",{className:e})})})]})}}]),n}(s.Component);t.a=h},99:function(e,t,n){"use strict";n(0);var r=n(69),a=n(109),i=n(84),o=n(26),s=n(17),l=n(101),c=n(1);t.a=function(e){for(var t=function(t){e.onCompartmentSelection(t)},n=[Object(c.jsx)(o.a.Item,{onClick:function(){return t(0)},children:"All Compartments"})],u=function(){var e=m;n.push(Object(c.jsxs)(o.a.Item,{onClick:function(){return t(e+1)},children:["Compartment ",e+1]}))},m=0;m<e.numCompartments-1;++m)u();var h="";return h=0===e.numCompartments?"No Compartment Data":0===e.selection?"All Compartments":"Compartment "+e.selection,Object(c.jsx)(l.a,{md:3,className:"justify-content-end",children:Object(c.jsx)(r.a,{children:Object(c.jsx)(a.a,{in:e.open,children:Object(c.jsx)(i.a,{children:Object(c.jsx)(i.a.Body,{children:Object(c.jsxs)(s.a,{children:[Object(c.jsxs)(s.a.Check,{className:"form-switch",children:[Object(c.jsx)(s.a.Check.Input,{checked:e.displayProtein,disabled:0===e.numCompartments,onChange:function(t){e.onDisplayProtein(t.target.checked)}}),Object(c.jsx)(s.a.Check.Label,{children:"Display Protein"})]}),Object(c.jsxs)(s.a.Check,{className:"form-switch",children:[Object(c.jsx)(s.a.Check.Input,{checked:e.displaySegmentation,disabled:0===e.numCompartments,onChange:function(t){e.onDisplaySegmentation(t.target.checked)}}),Object(c.jsx)(s.a.Check.Label,{children:"Display Segmentation"})]}),"Protein Visualisation Distance Cutoff",Object(c.jsx)(s.a.Range,{disabled:0===e.numCompartments,onChange:function(t){e.onIsovalue(t.target.value)}}),Object(c.jsxs)(o.a,{children:[Object(c.jsx)(o.a.Toggle,{disabled:0===e.numCompartments,children:h}),Object(c.jsx)(o.a.Menu,{children:n})]}),"Performance Options",Object(c.jsxs)(s.a.Check,{className:"form-switch",children:[Object(c.jsx)(s.a.Check.Input,{checked:e.useLod,onChange:function(t){e.onUseLod(t.target.checked)}}),Object(c.jsx)(s.a.Check.Label,{children:"Use LoD"})]}),"Debug Options",Object(c.jsxs)(s.a.Check,{className:"form-switch",children:[Object(c.jsx)(s.a.Check.Input,{checked:e.debugSamples,onChange:function(t){e.onDebugSamples(t.target.checked)}}),Object(c.jsx)(s.a.Check.Label,{children:"Display Texture Samples"})]})]})})})})})})}}},[[148,1,2]]]);
//# sourceMappingURL=main.1d6d1739.chunk.js.map